<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4. Geocentric Models | Statistical Rethinking - Notes</title>
  <meta name="description" content="Study notes for Statistical Rethinking book" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4. Geocentric Models | Statistical Rethinking - Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Study notes for Statistical Rethinking book" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4. Geocentric Models | Statistical Rethinking - Notes" />
  
  <meta name="twitter:description" content="Study notes for Statistical Rethinking book" />
  

<meta name="author" content="Hamza" />


<meta name="date" content="2024-05-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sampling-the-imaginary.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Rethinking (Study Notes)</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="the-golem-of-prague.html"><a href="the-golem-of-prague.html"><i class="fa fa-check"></i>1. The Golem of Prague</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html"><i class="fa fa-check"></i>2. Small Worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#example-p.-33"><i class="fa fa-check"></i>Example (p. 33)</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i>Grid Approximation</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i>Quadratic Approximation</a></li>
<li class="chapter" data-level="" data-path="small-worlds-and-large-worlds.html"><a href="small-worlds-and-large-worlds.html#markov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i>Markov Chain Monte Carlo (MCMC)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html"><i class="fa fa-check"></i>3. Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i>Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i>Sampling to summarize</a>
<ul>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-boundaries"><i class="fa fa-check"></i>Intervals of defined boundaries</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#intervals-of-defined-mass"><i class="fa fa-check"></i>Intervals of defined mass</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#point-estimates"><i class="fa fa-check"></i>Point Estimates</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#final-notes-on-summarization"><i class="fa fa-check"></i>Final Notes on Summarization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i>Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#dummy-data"><i class="fa fa-check"></i>Dummy Data</a></li>
<li class="chapter" data-level="" data-path="sampling-the-imaginary.html"><a href="sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i>Model Checking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i>4. Geocentric Models</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-distribution"><i class="fa fa-check"></i>Normal Distribution</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-addition"><i class="fa fa-check"></i>Normal by Addition</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-multiplication"><i class="fa fa-check"></i>Normal by multiplication</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#normal-by-log-multiplication"><i class="fa fa-check"></i>Normal by log-multiplication</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#gaussian-model-of-human-height"><i class="fa fa-check"></i>Gaussian model of human height</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#the-data"><i class="fa fa-check"></i>The data</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model-and-prior"><i class="fa fa-check"></i>The model and prior</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i>Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior"><i class="fa fa-check"></i>Sampling from the posterior</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-with-quap"><i class="fa fa-check"></i>Finding the posterior with <code>quap</code></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap"><i class="fa fa-check"></i>Sampling from a <code>quap</code></a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#variance-covariance-matrix"><i class="fa fa-check"></i>Variance-Covariance Matrix</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i>Linear prediction</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-model-strategy-probabilistic-approach"><i class="fa fa-check"></i>Linear model strategy: probabilistic approach</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#priors"><i class="fa fa-check"></i>Priors</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution"><i class="fa fa-check"></i>Finding the posterior distribution</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#prediction-intervals"><i class="fa fa-check"></i>Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-from-lines"><i class="fa fa-check"></i>Curves from lines</a>
<ul>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i>Polynomial regression</a></li>
<li class="chapter" data-level="" data-path="geocentric-models.html"><a href="geocentric-models.html#splines"><i class="fa fa-check"></i>Splines</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking - Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geocentric-models" class="section level1 hasAnchor">
<h1>4. Geocentric Models<a href="geocentric-models.html#geocentric-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="normal-distribution" class="section level2 hasAnchor">
<h2>Normal Distribution<a href="geocentric-models.html#normal-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="normal-by-addition" class="section level3 hasAnchor">
<h3>Normal by Addition<a href="geocentric-models.html#normal-by-addition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>(Keep in mind the example of field soccer, coin tossing, and stepping right and left on page 72)</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="geocentric-models.html#cb48-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb48-2"><a href="geocentric-models.html#cb48-2" tabindex="-1"></a><span class="co"># given that the steps for each person is represented by a list of 16 random numbers</span></span>
<span id="cb48-3"><a href="geocentric-models.html#cb48-3" tabindex="-1"></a><span class="co"># between -1 and 1:</span></span>
<span id="cb48-4"><a href="geocentric-models.html#cb48-4" tabindex="-1"></a><span class="co"># run 1000 simulation of stepping left and right, and store the final result/position</span></span>
<span id="cb48-5"><a href="geocentric-models.html#cb48-5" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">sum</span>(<span class="fu">runif</span>(<span class="dv">16</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)))</span>
<span id="cb48-6"><a href="geocentric-models.html#cb48-6" tabindex="-1"></a></span>
<span id="cb48-7"><a href="geocentric-models.html#cb48-7" tabindex="-1"></a><span class="co"># plot the end positions around the half line of soccer field</span></span>
<span id="cb48-8"><a href="geocentric-models.html#cb48-8" tabindex="-1"></a><span class="fu">plot</span>(pos)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="geocentric-models.html#cb49-1" tabindex="-1"></a><span class="co"># plot the density of the positions</span></span>
<span id="cb49-2"><a href="geocentric-models.html#cb49-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(pos))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
</div>
<div id="normal-by-multiplication" class="section level3 hasAnchor">
<h3>Normal by multiplication<a href="geocentric-models.html#normal-by-multiplication" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>(See the example on page 74) Note that the interaction between the growth deviations converges to Gaussian dist as long as the effect is small.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="geocentric-models.html#cb50-1" tabindex="-1"></a>growth_samll_effect <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">1000</span>, <span class="fu">prod</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">runif</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="fl">0.1</span>)))</span>
<span id="cb50-2"><a href="geocentric-models.html#cb50-2" tabindex="-1"></a><span class="fu">dens</span>(growth_samll_effect, <span class="at">norm.comp =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="geocentric-models.html#cb51-1" tabindex="-1"></a>growth_big_effect <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">prod</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">runif</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="fl">0.5</span>)))</span>
<span id="cb51-2"><a href="geocentric-models.html#cb51-2" tabindex="-1"></a><span class="fu">dens</span>(growth_big_effect, <span class="at">norm.comp =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
<div id="normal-by-log-multiplication" class="section level3 hasAnchor">
<h3>Normal by log-multiplication<a href="geocentric-models.html#normal-by-log-multiplication" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Multiplication interactions of large deviations converges to Gaussian dist when we measure the outcomes on the log scale.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="geocentric-models.html#cb52-1" tabindex="-1"></a>log.big <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">10000</span>, <span class="fu">log</span>(<span class="fu">prod</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">runif</span>(<span class="dv">12</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))))</span>
<span id="cb52-2"><a href="geocentric-models.html#cb52-2" tabindex="-1"></a><span class="fu">dens</span>(log.big, <span class="at">norm.comp =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
</div>
<div id="gaussian-model-of-human-height" class="section level2 hasAnchor">
<h2>Gaussian model of human height<a href="geocentric-models.html#gaussian-model-of-human-height" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="the-data" class="section level3 hasAnchor">
<h3>The data<a href="geocentric-models.html#the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="geocentric-models.html#cb53-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb53-2"><a href="geocentric-models.html#cb53-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb53-3"><a href="geocentric-models.html#cb53-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb53-4"><a href="geocentric-models.html#cb53-4" tabindex="-1"></a></span>
<span id="cb53-5"><a href="geocentric-models.html#cb53-5" tabindex="-1"></a><span class="co"># explore data</span></span>
<span id="cb53-6"><a href="geocentric-models.html#cb53-6" tabindex="-1"></a><span class="fu">str</span>(d)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    544 obs. of  4 variables:
##  $ height: num  152 140 137 157 145 ...
##  $ weight: num  47.8 36.5 31.9 53 41.3 ...
##  $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int  1 0 0 1 0 1 0 1 0 1 ...</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="geocentric-models.html#cb55-1" tabindex="-1"></a><span class="co"># data summary</span></span>
<span id="cb55-2"><a href="geocentric-models.html#cb55-2" tabindex="-1"></a><span class="fu">precis</span>(d, <span class="at">hist=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##               mean         sd      5.5%     94.5%
## height 138.2635963 27.6024476 81.108550 165.73500
## weight  35.6106176 14.7191782  9.360721  54.50289
## age     29.3443934 20.7468882  1.000000  66.13500
## male     0.4724265  0.4996986  0.000000   1.00000</code></pre>
</div>
<div id="the-model-and-prior" class="section level3 hasAnchor">
<h3>The model and prior<a href="geocentric-models.html#the-model-and-prior" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Based on domain-specific information, we decide that the range of plausible human heights is <span class="math inline">\(178 \mp 40\)</span>. The std. deviation must be basically positive <span class="math inline">\(h_i \sim Normal(\mu, \sigma)\)</span></p>
<p>Given that the parameters are independent, the prior is:</p>
<p><span class="math inline">\(Pr(\mu, \sigma) = Pr(\mu)Pr(\sigma)\)</span></p>
<p>Where:</p>
<p><span class="math inline">\(\mu \sim Normal(178,20)\)</span> <span class="math inline">\(\sigma \sim Uniform(0, 50)\)</span></p>
<p>Let’s plot the priors: - Mean</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="geocentric-models.html#cb57-1" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="dv">178</span>, <span class="dv">20</span>), <span class="at">from=</span><span class="dv">100</span>, <span class="at">to=</span><span class="dv">250</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<ul>
<li>Std. deviation</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="geocentric-models.html#cb58-1" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dunif</span>(x, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">60</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Let’s simulate heights based on the priors. This is called the <em>prior predictive simulation</em>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="geocentric-models.html#cb59-1" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb59-2"><a href="geocentric-models.html#cb59-2" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb59-3"><a href="geocentric-models.html#cb59-3" tabindex="-1"></a></span>
<span id="cb59-4"><a href="geocentric-models.html#cb59-4" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, sample_mu, sample_sigma)</span>
<span id="cb59-5"><a href="geocentric-models.html#cb59-5" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>So far, the model is defined before showing it the data. We can change the prior <span class="math inline">\(\mu\)</span> std. deviation to see how the model is sensitive to the prior choices that aren’t relying on scintific knowledge as we did.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="geocentric-models.html#cb60-1" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>, <span class="dv">100</span>)</span>
<span id="cb60-2"><a href="geocentric-models.html#cb60-2" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb60-3"><a href="geocentric-models.html#cb60-3" tabindex="-1"></a></span>
<span id="cb60-4"><a href="geocentric-models.html#cb60-4" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, sample_mu, sample_sigma)</span>
<span id="cb60-5"><a href="geocentric-models.html#cb60-5" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>Note how the result doesn’t make sense with negative and very large heights.</p>
</div>
<div id="grid-approximation-of-the-posterior-distribution" class="section level3 hasAnchor">
<h3>Grid approximation of the posterior distribution<a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since we have 2 parameters, grid approx. method is not practical. However, we will try using it computing the log-likelihood:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="geocentric-models.html#cb61-1" tabindex="-1"></a><span class="co"># we will compute the approximation using the height data of persons over 18 y.o.</span></span>
<span id="cb61-2"><a href="geocentric-models.html#cb61-2" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span>
<span id="cb61-3"><a href="geocentric-models.html#cb61-3" tabindex="-1"></a></span>
<span id="cb61-4"><a href="geocentric-models.html#cb61-4" tabindex="-1"></a></span>
<span id="cb61-5"><a href="geocentric-models.html#cb61-5" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">160</span>, <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb61-6"><a href="geocentric-models.html#cb61-6" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">7</span>, <span class="at">to=</span><span class="dv">9</span>, <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb61-7"><a href="geocentric-models.html#cb61-7" tabindex="-1"></a></span>
<span id="cb61-8"><a href="geocentric-models.html#cb61-8" tabindex="-1"></a><span class="co"># Create a Data Frame from All Combinations of Factor Variables</span></span>
<span id="cb61-9"><a href="geocentric-models.html#cb61-9" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mu=</span>mu.list, <span class="at">sigma=</span>sigma.list)</span>
<span id="cb61-10"><a href="geocentric-models.html#cb61-10" tabindex="-1"></a></span>
<span id="cb61-11"><a href="geocentric-models.html#cb61-11" tabindex="-1"></a><span class="co"># compute the log-likelihood</span></span>
<span id="cb61-12"><a href="geocentric-models.html#cb61-12" tabindex="-1"></a>post<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb61-13"><a href="geocentric-models.html#cb61-13" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post),</span>
<span id="cb61-14"><a href="geocentric-models.html#cb61-14" tabindex="-1"></a>  <span class="cf">function</span>(i) <span class="fu">sum</span> (</span>
<span id="cb61-15"><a href="geocentric-models.html#cb61-15" tabindex="-1"></a>    <span class="fu">dnorm</span>(d2<span class="sc">$</span>height, post<span class="sc">$</span>mu[i], post<span class="sc">$</span>sigma[i], <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-16"><a href="geocentric-models.html#cb61-16" tabindex="-1"></a>  )</span>
<span id="cb61-17"><a href="geocentric-models.html#cb61-17" tabindex="-1"></a>)</span>
<span id="cb61-18"><a href="geocentric-models.html#cb61-18" tabindex="-1"></a></span>
<span id="cb61-19"><a href="geocentric-models.html#cb61-19" tabindex="-1"></a>post<span class="sc">$</span>prod <span class="ot">&lt;-</span> post<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>(post<span class="sc">$</span>mu, <span class="dv">178</span>, <span class="dv">20</span>, <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">dunif</span>(post<span class="sc">$</span>sigma, <span class="dv">0</span>, <span class="dv">50</span>, <span class="cn">TRUE</span>)</span>
<span id="cb61-20"><a href="geocentric-models.html#cb61-20" tabindex="-1"></a></span>
<span id="cb61-21"><a href="geocentric-models.html#cb61-21" tabindex="-1"></a></span>
<span id="cb61-22"><a href="geocentric-models.html#cb61-22" tabindex="-1"></a>post<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>(post<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post<span class="sc">$</span>prod))</span>
<span id="cb61-23"><a href="geocentric-models.html#cb61-23" tabindex="-1"></a><span class="fu">contour_xyz</span>(post<span class="sc">$</span>mu, post<span class="sc">$</span>sigma, post<span class="sc">$</span>prob)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="geocentric-models.html#cb62-1" tabindex="-1"></a><span class="fu">image_xyz</span>(post<span class="sc">$</span>mu, post<span class="sc">$</span>sigma, post<span class="sc">$</span>prob)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
</div>
<div id="sampling-from-the-posterior" class="section level3 hasAnchor">
<h3>Sampling from the posterior<a href="geocentric-models.html#sampling-from-the-posterior" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="geocentric-models.html#cb63-1" tabindex="-1"></a><span class="co"># generate random indexes of rows</span></span>
<span id="cb63-2"><a href="geocentric-models.html#cb63-2" tabindex="-1"></a>sample.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post), <span class="at">size=</span><span class="fl">1e4</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span>post<span class="sc">$</span>prob)</span>
<span id="cb63-3"><a href="geocentric-models.html#cb63-3" tabindex="-1"></a>sample.mu <span class="ot">&lt;-</span> post<span class="sc">$</span>mu[sample.rows]</span>
<span id="cb63-4"><a href="geocentric-models.html#cb63-4" tabindex="-1"></a>sample.sigma <span class="ot">&lt;-</span> post<span class="sc">$</span>sigma[sample.rows]</span>
<span id="cb63-5"><a href="geocentric-models.html#cb63-5" tabindex="-1"></a></span>
<span id="cb63-6"><a href="geocentric-models.html#cb63-6" tabindex="-1"></a><span class="co"># this shows the most plausible combinations of mu and sigma</span></span>
<span id="cb63-7"><a href="geocentric-models.html#cb63-7" tabindex="-1"></a><span class="fu">plot</span>(sample.mu, sample.sigma, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Let’s check the shape of marginal posterior densities:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="geocentric-models.html#cb64-1" tabindex="-1"></a><span class="fu">dens</span>(sample.mu)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="geocentric-models.html#cb65-1" tabindex="-1"></a><span class="fu">dens</span>(sample.sigma)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-47-2.png" width="672" /></p>
<p>Note that the density for sigma has a longer right tail</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="geocentric-models.html#cb66-1" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(d2<span class="sc">$</span>height, <span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb66-2"><a href="geocentric-models.html#cb66-2" tabindex="-1"></a></span>
<span id="cb66-3"><a href="geocentric-models.html#cb66-3" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">170</span> , <span class="at">length.out=</span><span class="dv">200</span> ) </span>
<span id="cb66-4"><a href="geocentric-models.html#cb66-4" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">4</span> , <span class="at">to=</span><span class="dv">20</span> , <span class="at">length.out=</span><span class="dv">200</span> ) </span>
<span id="cb66-5"><a href="geocentric-models.html#cb66-5" tabindex="-1"></a>post2 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( <span class="at">mu=</span>mu.list , <span class="at">sigma=</span>sigma.list ) </span>
<span id="cb66-6"><a href="geocentric-models.html#cb66-6" tabindex="-1"></a>post2<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post2) , <span class="cf">function</span>(i) <span class="fu">sum</span>( <span class="fu">dnorm</span>( d3 , <span class="at">mean=</span>post2<span class="sc">$</span>mu[i] , <span class="at">sd=</span>post2<span class="sc">$</span>sigma[i] , <span class="at">log=</span><span class="cn">TRUE</span> ) ) ) </span>
<span id="cb66-7"><a href="geocentric-models.html#cb66-7" tabindex="-1"></a>post2<span class="sc">$</span>prod <span class="ot">&lt;-</span> post2<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>( post2<span class="sc">$</span>mu , <span class="dv">178</span> , <span class="dv">20</span> , <span class="cn">TRUE</span> ) <span class="sc">+</span> <span class="fu">dunif</span>( post2<span class="sc">$</span>sigma , <span class="dv">0</span> , <span class="dv">50</span> , <span class="cn">TRUE</span> ) </span>
<span id="cb66-8"><a href="geocentric-models.html#cb66-8" tabindex="-1"></a>post2<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>( post2<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post2<span class="sc">$</span>prod) ) </span>
<span id="cb66-9"><a href="geocentric-models.html#cb66-9" tabindex="-1"></a></span>
<span id="cb66-10"><a href="geocentric-models.html#cb66-10" tabindex="-1"></a>sample2.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post2) , <span class="at">size=</span><span class="fl">1e4</span> , <span class="at">replace=</span><span class="cn">TRUE</span> , <span class="at">prob=</span>post2<span class="sc">$</span>prob ) </span>
<span id="cb66-11"><a href="geocentric-models.html#cb66-11" tabindex="-1"></a>sample2.mu <span class="ot">&lt;-</span> post2<span class="sc">$</span>mu[ sample2.rows ] </span>
<span id="cb66-12"><a href="geocentric-models.html#cb66-12" tabindex="-1"></a>sample2.sigma <span class="ot">&lt;-</span> post2<span class="sc">$</span>sigma[ sample2.rows ] </span>
<span id="cb66-13"><a href="geocentric-models.html#cb66-13" tabindex="-1"></a><span class="fu">plot</span>( sample2.mu , sample2.sigma , <span class="at">cex=</span><span class="fl">0.5</span> , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.1</span>) , <span class="at">xlab=</span><span class="st">&quot;mu&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;sigma&quot;</span> , <span class="at">pch=</span><span class="dv">16</span> )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="geocentric-models.html#cb67-1" tabindex="-1"></a><span class="fu">dens</span>(sample2.sigma, <span class="at">norm.comp =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
</div>
<div id="finding-the-posterior-with-quap" class="section level3 hasAnchor">
<h3>Finding the posterior with <code>quap</code><a href="geocentric-models.html#finding-the-posterior-with-quap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Quadratic Approximation is good to make inferences about the shape of posterior, particularly its peak that lie at the maximum a posteriori (MAP)</p>
<p>Let’s first load the data:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="geocentric-models.html#cb68-1" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb68-2"><a href="geocentric-models.html#cb68-2" tabindex="-1"></a><span class="fu">library</span>(rethinking) </span>
<span id="cb68-3"><a href="geocentric-models.html#cb68-3" tabindex="-1"></a><span class="fu">data</span>(Howell1) </span>
<span id="cb68-4"><a href="geocentric-models.html#cb68-4" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1 </span>
<span id="cb68-5"><a href="geocentric-models.html#cb68-5" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[ d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span> , ]</span></code></pre></div>
<p>Now, we will define our model with code:</p>
<p><span class="math inline">\(h_i \sim Normal(\mu, \sigma)\)</span></p>
<p><span class="math inline">\(\mu \sim Normal(178,20)\)</span></p>
<p><span class="math inline">\(\sigma \sim Uniform(0, 50)\)</span></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="geocentric-models.html#cb69-1" tabindex="-1"></a>flist <span class="ot">&lt;-</span> <span class="fu">alist</span>(</span>
<span id="cb69-2"><a href="geocentric-models.html#cb69-2" tabindex="-1"></a>  height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb69-3"><a href="geocentric-models.html#cb69-3" tabindex="-1"></a>  mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb69-4"><a href="geocentric-models.html#cb69-4" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb69-5"><a href="geocentric-models.html#cb69-5" tabindex="-1"></a>)</span></code></pre></div>
<p>Note: <code>alist</code> stores formulas without executing the expression in the code unlike <code>list</code></p>
<p>Now, we fit the mode to the data in `d2`:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="geocentric-models.html#cb70-1" tabindex="-1"></a>m4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(flist, <span class="at">data=</span>d2)</span></code></pre></div>
<p>Let’s take a glance at the model (i.e posterior dist):</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="geocentric-models.html#cb71-1" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##             mean        sd       5.5%      94.5%
## mu    154.607201 0.4119492 153.948827 155.265575
## sigma   7.730478 0.2913055   7.264916   8.196041</code></pre>
</div>
<div id="sampling-from-a-quap" class="section level3 hasAnchor">
<h3>Sampling from a <code>quap</code><a href="geocentric-models.html#sampling-from-a-quap" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="geocentric-models.html#cb73-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.1</span>, <span class="at">n=</span><span class="fl">1e4</span>)</span>
<span id="cb73-2"><a href="geocentric-models.html#cb73-2" tabindex="-1"></a><span class="fu">head</span>(post)</span></code></pre></div>
<pre><code>##         mu    sigma
## 1 155.3808 7.372322
## 2 154.8912 7.774284
## 3 155.1147 7.671096
## 4 154.1441 7.818519
## 5 155.0759 7.983457
## 6 154.8982 7.093661</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="geocentric-models.html#cb75-1" tabindex="-1"></a><span class="fu">precis</span>(post, <span class="at">hist=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##             mean        sd       5.5%      94.5%
## mu    154.604963 0.4134325 153.952468 155.276243
## sigma   7.732341 0.2863066   7.282393   8.195132</code></pre>
<p>Comparing these values to the output from <code>precis(m4.1)</code>, we found it very close.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="geocentric-models.html#cb77-1" tabindex="-1"></a><span class="fu">plot</span>(post)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div id="sampling-the-multivariate-posterior-wo-rethinking" class="section level4 hasAnchor">
<h4>Sampling the multivariate posterior w/o <code>rethinking</code><a href="geocentric-models.html#sampling-the-multivariate-posterior-wo-rethinking" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function <code>extract.samples</code> runs the following simulation that samples random vectors of multivariate Gaussian values. This simulation requires computing the variance-covariance matrix</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="geocentric-models.html#cb78-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb78-2"><a href="geocentric-models.html#cb78-2" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="at">n=</span><span class="fl">1e4</span>, <span class="at">mu=</span><span class="fu">coef</span>(m4<span class="fl">.1</span>), <span class="at">Sigma=</span><span class="fu">vcov</span>(m4<span class="fl">.1</span>))</span>
<span id="cb78-3"><a href="geocentric-models.html#cb78-3" tabindex="-1"></a><span class="fu">plot</span>(post)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
</div>
<div id="variance-covariance-matrix" class="section level3 hasAnchor">
<h3>Variance-Covariance Matrix<a href="geocentric-models.html#variance-covariance-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>It is an essential compnent in the <code>quap</code> algorithm.</p></li>
<li><p>It tells us how each parameter relates to every other parameter in the posterior distribution.</p></li>
<li><p>It can be factored into 2 elements:</p>
<ul>
<li><p>Vector of variances for the parameters <code>diag(vcov(model))</code></p></li>
<li><p>Correlation matrix that tells how changes in one parameter lead to correlated changes in the others <code>cov2cor(vcov(model))</code></p></li>
</ul></li>
</ul>
</div>
</div>
<div id="linear-prediction" class="section level2 hasAnchor">
<h2>Linear prediction<a href="geocentric-models.html#linear-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using the association between predictor variables and outcome variable, we want to predict the later. This is how linear regression works.</p>
<div id="linear-model-strategy-probabilistic-approach" class="section level3 hasAnchor">
<h3>Linear model strategy: probabilistic approach<a href="geocentric-models.html#linear-model-strategy-probabilistic-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>We tell the model (golem) the following: “Assume that the predictor variable has a constant and additive relationship to the mean of the outcome. Consider all the lines (formed by the combinations of parameter values) that relate one variable (or more) to the other. Rank all of these lines by plausibility, given these data.”</p></li>
<li><p>The resulted model is a posterior distribution</p></li>
</ul>
<p>In the following example, we want to predict the height using the weight as a predictor variable. This code plot the data to use in model fitting:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="geocentric-models.html#cb79-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb79-2"><a href="geocentric-models.html#cb79-2" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb79-3"><a href="geocentric-models.html#cb79-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb79-4"><a href="geocentric-models.html#cb79-4" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span>
<span id="cb79-5"><a href="geocentric-models.html#cb79-5" tabindex="-1"></a></span>
<span id="cb79-6"><a href="geocentric-models.html#cb79-6" tabindex="-1"></a><span class="fu">plot</span>(d2<span class="sc">$</span>height <span class="sc">~</span> d2<span class="sc">$</span>weight)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>We want to use the Gaussian model of height we built in the previous chapters but making the mean of height <span class="math inline">\(\mu_i\)</span> is a function of weights where weight values are denoted by <span class="math inline">\(x\)</span>. Here is the model:</p>
<p><span class="math inline">\(h_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha + \beta(x_i - \bar{x})\)</span></p>
<p><span class="math inline">\(\alpha \sim Normal(178, 20)\)</span></p>
<p><span class="math inline">\(\beta \sim Normal(0, 10)\)</span></p>
<p><span class="math inline">\(\sigma \sim Uniform(0,50)\)</span></p>
<p>Notations:</p>
<ul>
<li><p><span class="math inline">\(\bar{x}\)</span> is the mean of weights</p></li>
<li><p><span class="math inline">\(x_i\)</span> weight at row <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(\mu_i\)</span> the mean of heights are row <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(h_i\)</span> the height at row <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(\alpha, \beta\)</span> are parameters to learn</p></li>
</ul>
<p>Note all relationships are <strong>Stochastic</strong> except the relationship between the height mean and weight.</p>
<p>The parameters are made up as devices that will help us to manipulate <span class="math inline">\(\mu\)</span>. Here is what each parameter does:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\alpha\)</span> (intercept): represents the expected height when <span class="math inline">\(x_i=\bar{x}\)</span></li>
<li><span class="math inline">\(\beta\)</span> (slope): represents the rate of change in expectation when <span class="math inline">\(x_i\)</span> changes by 1 unit</li>
</ol>
</div>
<div id="priors" class="section level3 hasAnchor">
<h3>Priors<a href="geocentric-models.html#priors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>The unobserved variables are called <em>parameters</em> (<span class="math inline">\(\alpha, \beta, \sigma\)</span>) and their distributions are called <em>priors.</em></p></li>
<li><p>Each combination of parameter values implies a unique line</p></li>
<li><p>Let’s simulate the prior predictive distribution to see the possible lines</p></li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="geocentric-models.html#cb80-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb80-2"><a href="geocentric-models.html#cb80-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb80-3"><a href="geocentric-models.html#cb80-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb80-4"><a href="geocentric-models.html#cb80-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb80-5"><a href="geocentric-models.html#cb80-5" tabindex="-1"></a></span>
<span id="cb80-6"><a href="geocentric-models.html#cb80-6" tabindex="-1"></a><span class="co"># prepare the canvas for plotting</span></span>
<span id="cb80-7"><a href="geocentric-models.html#cb80-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>), <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb80-8"><a href="geocentric-models.html#cb80-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="co"># no one is shorter than zero!</span></span>
<span id="cb80-9"><a href="geocentric-models.html#cb80-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) <span class="co"># the world&#39;s tallest person</span></span>
<span id="cb80-10"><a href="geocentric-models.html#cb80-10" tabindex="-1"></a></span>
<span id="cb80-11"><a href="geocentric-models.html#cb80-11" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb80-12"><a href="geocentric-models.html#cb80-12" tabindex="-1"></a></span>
<span id="cb80-13"><a href="geocentric-models.html#cb80-13" tabindex="-1"></a><span class="co"># simulate the possible lines</span></span>
<span id="cb80-14"><a href="geocentric-models.html#cb80-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x<span class="sc">-</span>xbar), </span>
<span id="cb80-15"><a href="geocentric-models.html#cb80-15" tabindex="-1"></a>                     <span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb80-16"><a href="geocentric-models.html#cb80-16" tabindex="-1"></a>                     <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb80-17"><a href="geocentric-models.html#cb80-17" tabindex="-1"></a>                     <span class="at">add=</span><span class="cn">TRUE</span>,</span>
<span id="cb80-18"><a href="geocentric-models.html#cb80-18" tabindex="-1"></a>                     <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>As we can see, not all the lines seem to represent the relationship between weight and height for human. Negative relationship doesn’t make sense in this context.</p>
<p>We want to restrict <span class="math inline">\(\beta\)</span> to positive numbers so we only get positive relationship. Therefore, we can define the prior as Log-Normal instead to enforce positive relationship:</p>
<p><span class="math display">\[
\beta \sim Log-Normal(0,1)
\]</span></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="geocentric-models.html#cb81-1" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb81-2"><a href="geocentric-models.html#cb81-2" tabindex="-1"></a><span class="fu">dens</span>(b, <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">5</span>), <span class="at">adj=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>We can see the distribution is defined only on the positive beta values.</p>
<p>Now, let’s do the prior predictive simulation again with the new prior:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="geocentric-models.html#cb82-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb82-2"><a href="geocentric-models.html#cb82-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb82-3"><a href="geocentric-models.html#cb82-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb82-4"><a href="geocentric-models.html#cb82-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># log-normal prior</span></span>
<span id="cb82-5"><a href="geocentric-models.html#cb82-5" tabindex="-1"></a></span>
<span id="cb82-6"><a href="geocentric-models.html#cb82-6" tabindex="-1"></a><span class="co"># prepare the canvas for plotting</span></span>
<span id="cb82-7"><a href="geocentric-models.html#cb82-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>), <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb82-8"><a href="geocentric-models.html#cb82-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="co"># no one is shorter than zero!</span></span>
<span id="cb82-9"><a href="geocentric-models.html#cb82-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) <span class="co"># the world&#39;s tallest person</span></span>
<span id="cb82-10"><a href="geocentric-models.html#cb82-10" tabindex="-1"></a></span>
<span id="cb82-11"><a href="geocentric-models.html#cb82-11" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb82-12"><a href="geocentric-models.html#cb82-12" tabindex="-1"></a></span>
<span id="cb82-13"><a href="geocentric-models.html#cb82-13" tabindex="-1"></a><span class="co"># simulate the possible lines</span></span>
<span id="cb82-14"><a href="geocentric-models.html#cb82-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x<span class="sc">-</span>xbar), </span>
<span id="cb82-15"><a href="geocentric-models.html#cb82-15" tabindex="-1"></a>                     <span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb82-16"><a href="geocentric-models.html#cb82-16" tabindex="-1"></a>                     <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb82-17"><a href="geocentric-models.html#cb82-17" tabindex="-1"></a>                     <span class="at">add=</span><span class="cn">TRUE</span>,</span>
<span id="cb82-18"><a href="geocentric-models.html#cb82-18" tabindex="-1"></a>                     <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p>Now, the result is much more sensible!</p>
</div>
<div id="finding-the-posterior-distribution" class="section level3 hasAnchor">
<h3>Finding the posterior distribution<a href="geocentric-models.html#finding-the-posterior-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The model is defined now along with the priors. We are now ready to build the posterior approximation using <code>quap</code></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="geocentric-models.html#cb83-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb83-2"><a href="geocentric-models.html#cb83-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb83-3"><a href="geocentric-models.html#cb83-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb83-4"><a href="geocentric-models.html#cb83-4" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span>
<span id="cb83-5"><a href="geocentric-models.html#cb83-5" tabindex="-1"></a></span>
<span id="cb83-6"><a href="geocentric-models.html#cb83-6" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb83-7"><a href="geocentric-models.html#cb83-7" tabindex="-1"></a></span>
<span id="cb83-8"><a href="geocentric-models.html#cb83-8" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb83-9"><a href="geocentric-models.html#cb83-9" tabindex="-1"></a></span>
<span id="cb83-10"><a href="geocentric-models.html#cb83-10" tabindex="-1"></a>m4<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb83-11"><a href="geocentric-models.html#cb83-11" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb83-12"><a href="geocentric-models.html#cb83-12" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb83-13"><a href="geocentric-models.html#cb83-13" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight<span class="sc">-</span>xbar),</span>
<span id="cb83-14"><a href="geocentric-models.html#cb83-14" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb83-15"><a href="geocentric-models.html#cb83-15" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb83-16"><a href="geocentric-models.html#cb83-16" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb83-17"><a href="geocentric-models.html#cb83-17" tabindex="-1"></a>  ),</span>
<span id="cb83-18"><a href="geocentric-models.html#cb83-18" tabindex="-1"></a>  <span class="at">data=</span>d2</span>
<span id="cb83-19"><a href="geocentric-models.html#cb83-19" tabindex="-1"></a>)</span></code></pre></div>
<p>To interpret the posterior, we can use either tables or plots. Plots gives more information about the posterior. However, let’s see the summary table:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="geocentric-models.html#cb84-1" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##              mean         sd        5.5%       94.5%
## a     154.6013671 0.27030766 154.1693633 155.0333710
## b       0.9032807 0.04192363   0.8362787   0.9702828
## sigma   5.0718809 0.19115478   4.7663786   5.3773831</code></pre>
<p>We also need to see the covariance among the parameters by computing the variance-covariance matrix:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="geocentric-models.html#cb86-1" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">vcov</span>(m4<span class="fl">.3</span>), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           a     b sigma
## a     0.073 0.000 0.000
## b     0.000 0.002 0.000
## sigma 0.000 0.000 0.037</code></pre>
<div id="plotting-the-posterior-against-the-data" class="section level4 hasAnchor">
<h4>Plotting the posterior against the data<a href="geocentric-models.html#plotting-the-posterior-against-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="geocentric-models.html#cb88-1" tabindex="-1"></a><span class="fu">plot</span>(height<span class="sc">~</span>weight, <span class="at">data=</span>d2, <span class="at">col=</span>rangi2)</span>
<span id="cb88-2"><a href="geocentric-models.html#cb88-2" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb88-3"><a href="geocentric-models.html#cb88-3" tabindex="-1"></a>a_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>a)</span>
<span id="cb88-4"><a href="geocentric-models.html#cb88-4" tabindex="-1"></a>b_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>b)</span>
<span id="cb88-5"><a href="geocentric-models.html#cb88-5" tabindex="-1"></a><span class="fu">curve</span>(a_map <span class="sc">+</span> b_map <span class="sc">*</span> (x<span class="sc">-</span>xbar), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="geocentric-models.html#cb89-1" tabindex="-1"></a>post[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##          a         b    sigma
## 1 154.5564 0.9000245 4.768499
## 2 154.4602 0.8474034 5.136055
## 3 154.7858 0.9440438 5.313512
## 4 154.4490 0.8806246 4.683555
## 5 154.4639 0.8397176 5.185017</code></pre>
</div>
<div id="uncertainty-around-the-mean" class="section level4 hasAnchor">
<h4>Uncertainty around the mean<a href="geocentric-models.html#uncertainty-around-the-mean" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We want to know the uncertainty around the mean of posterior in order to determine the confidence in the relationship between predictor and outcome, since the posterior we plot in the previous step is the MAP, which is the mean of many lines formed by the posterior.</p>
<p>Here is a sample of possible lines:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="geocentric-models.html#cb91-1" tabindex="-1"></a>post[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##          a         b    sigma
## 1 154.5564 0.9000245 4.768499
## 2 154.4602 0.8474034 5.136055
## 3 154.7858 0.9440438 5.313512
## 4 154.4490 0.8806246 4.683555
## 5 154.4639 0.8397176 5.185017</code></pre>
<p>Let’s see how the confident about the location of the mean changes based on data size. First, we will extract the first 10 cases and re-estimate the model:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="geocentric-models.html#cb93-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb93-2"><a href="geocentric-models.html#cb93-2" tabindex="-1"></a>dN <span class="ot">&lt;-</span> d2[<span class="dv">1</span><span class="sc">:</span>N, ]</span>
<span id="cb93-3"><a href="geocentric-models.html#cb93-3" tabindex="-1"></a>mN <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb93-4"><a href="geocentric-models.html#cb93-4" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb93-5"><a href="geocentric-models.html#cb93-5" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb93-6"><a href="geocentric-models.html#cb93-6" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a<span class="sc">+</span>b<span class="sc">*</span>(weight <span class="sc">-</span> <span class="fu">mean</span>(weight)),</span>
<span id="cb93-7"><a href="geocentric-models.html#cb93-7" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb93-8"><a href="geocentric-models.html#cb93-8" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb93-9"><a href="geocentric-models.html#cb93-9" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb93-10"><a href="geocentric-models.html#cb93-10" tabindex="-1"></a>  ), <span class="at">data=</span>dN</span>
<span id="cb93-11"><a href="geocentric-models.html#cb93-11" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot 20 of these lines to see what the uncertainty looks like:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="geocentric-models.html#cb94-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(mN, <span class="at">n=</span><span class="dv">20</span>)</span>
<span id="cb94-2"><a href="geocentric-models.html#cb94-2" tabindex="-1"></a></span>
<span id="cb94-3"><a href="geocentric-models.html#cb94-3" tabindex="-1"></a><span class="co"># plot the 10 sampled cases</span></span>
<span id="cb94-4"><a href="geocentric-models.html#cb94-4" tabindex="-1"></a><span class="fu">plot</span>(dN<span class="sc">$</span>weight, dN<span class="sc">$</span>height, </span>
<span id="cb94-5"><a href="geocentric-models.html#cb94-5" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">range</span>(d2<span class="sc">$</span>height),</span>
<span id="cb94-6"><a href="geocentric-models.html#cb94-6" tabindex="-1"></a>     <span class="at">col=</span>rangi2, <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb94-7"><a href="geocentric-models.html#cb94-7" tabindex="-1"></a></span>
<span id="cb94-8"><a href="geocentric-models.html#cb94-8" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">concat</span>(<span class="st">&quot;N = &quot;</span>, N))</span>
<span id="cb94-9"><a href="geocentric-models.html#cb94-9" tabindex="-1"></a></span>
<span id="cb94-10"><a href="geocentric-models.html#cb94-10" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) <span class="fu">curve</span>(post<span class="sc">$</span>a[i] <span class="sc">+</span> post<span class="sc">$</span>b[i] <span class="sc">*</span> (x<span class="sc">-</span><span class="fu">mean</span>(dN<span class="sc">$</span>weight)),                <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.3</span>), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="plotting-regression-intervals-and-contours" class="section level4 hasAnchor">
<h4>Plotting regression intervals and contours<a href="geocentric-models.html#plotting-regression-intervals-and-contours" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let’s find the quadratic posterior distribution of the mean height <span class="math inline">\(\mu\)</span> when weight is 50 kg. This distribution represents the relative plausibility of different values of the mean:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="geocentric-models.html#cb95-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb95-2"><a href="geocentric-models.html#cb95-2" tabindex="-1"></a>mu_at_50 <span class="ot">&lt;-</span> post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b <span class="sc">*</span> (<span class="dv">50</span><span class="sc">-</span>xbar)</span>
<span id="cb95-3"><a href="geocentric-models.html#cb95-3" tabindex="-1"></a><span class="fu">dens</span>(mu_at_50, <span class="at">col=</span>rangi2, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="st">&quot;mu|weight=50&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Compatibility interval of <span class="math inline">\(\mu\)</span> at 50 kg is:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="geocentric-models.html#cb96-1" tabindex="-1"></a><span class="fu">PI</span>(mu_at_50, <span class="at">prob =</span> <span class="fl">0.89</span>)</span></code></pre></div>
<pre><code>##       5%      94% 
## 158.5839 159.6832</code></pre>
<p>To do that for all weight values:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="geocentric-models.html#cb98-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.3</span>)</span>
<span id="cb98-2"><a href="geocentric-models.html#cb98-2" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:352] 157 157 157 158 157 ...</code></pre>
<p>The resulted matrix contains 352 columns, each corresponds to one row in the <code>d2</code> data. It contains 1000 rows, each represents a sample. Therefore, the matrix contains a distribution of <span class="math inline">\(\mu\)</span> for each individual in the original data <code>d2</code>.</p>
<p>Let’s plot the Gaussian distribution for each mean value:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="geocentric-models.html#cb100-1" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb100-2"><a href="geocentric-models.html#cb100-2" tabindex="-1"></a></span>
<span id="cb100-3"><a href="geocentric-models.html#cb100-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)  <span class="fu">points</span>(d2<span class="sc">$</span>weight, mu[i,], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<p>The pile of points represents the rows.</p>
<p>The plot is kind of missy, let’s do that for a small group of weight values</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="geocentric-models.html#cb101-1" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">25</span>, <span class="at">to=</span><span class="dv">70</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb101-2"><a href="geocentric-models.html#cb101-2" tabindex="-1"></a></span>
<span id="cb101-3"><a href="geocentric-models.html#cb101-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">weight=</span>weight.seq))</span>
<span id="cb101-4"><a href="geocentric-models.html#cb101-4" tabindex="-1"></a></span>
<span id="cb101-5"><a href="geocentric-models.html#cb101-5" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb101-6"><a href="geocentric-models.html#cb101-6" tabindex="-1"></a></span>
<span id="cb101-7"><a href="geocentric-models.html#cb101-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)  <span class="fu">points</span>(weight.seq, mu[i,], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Now, let’s summarize the distribution of mu</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="geocentric-models.html#cb102-1" tabindex="-1"></a><span class="co"># compute the mean of each column (dimension 2) of the matrix mu</span></span>
<span id="cb102-2"><a href="geocentric-models.html#cb102-2" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb102-3"><a href="geocentric-models.html#cb102-3" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb102-4"><a href="geocentric-models.html#cb102-4" tabindex="-1"></a></span>
<span id="cb102-5"><a href="geocentric-models.html#cb102-5" tabindex="-1"></a><span class="co"># plot the line and the interval</span></span>
<span id="cb102-6"><a href="geocentric-models.html#cb102-6" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, <span class="at">data=</span>d2, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb102-7"><a href="geocentric-models.html#cb102-7" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb102-8"><a href="geocentric-models.html#cb102-8" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="how-link-works" class="section level4 hasAnchor">
<h4>How <code>link</code> works<a href="geocentric-models.html#how-link-works" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This approach can be used to generate posterior predictions for any component of any model</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="geocentric-models.html#cb103-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb103-2"><a href="geocentric-models.html#cb103-2" tabindex="-1"></a>mu.link <span class="ot">&lt;-</span> <span class="cf">function</span>(weight) post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b<span class="sc">*</span>(weight<span class="sc">-</span>xbar)</span>
<span id="cb103-3"><a href="geocentric-models.html#cb103-3" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">70</span>,<span class="dv">1</span>)</span>
<span id="cb103-4"><a href="geocentric-models.html#cb103-4" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">sapply</span>(weight.seq, mu.link)</span>
<span id="cb103-5"><a href="geocentric-models.html#cb103-5" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb103-6"><a href="geocentric-models.html#cb103-6" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span></code></pre></div>
</div>
<div id="summary-recipe-of-generating-predictions-and-intervals-from-the-posterior" class="section level4 hasAnchor">
<h4>Summary: recipe of generating predictions and intervals from the posterior<a href="geocentric-models.html#summary-recipe-of-generating-predictions-and-intervals-from-the-posterior" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Use <code>link</code> to generate distributions posterior values for <span class="math inline">\(\mu\)</span></li>
<li>Use <code>mean</code> or <code>PI</code> to find averages and bounds of <span class="math inline">\(\mu\)</span> for each value of the predictor variable</li>
<li>Plot the lines and intervals using <code>lines</code> and <code>shades</code> or the distribution of the prediction given the value of predictor(s)</li>
</ol>
</div>
</div>
<div id="prediction-intervals" class="section level3 hasAnchor">
<h3>Prediction intervals<a href="geocentric-models.html#prediction-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What we’ve done so far is just use samples from the posterior to visualize the uncertainty in <span class="math inline">\(\mu_i\)</span>. Now, we want to compute the predictions of heights that’s distributed according to: <span class="math inline">\(h_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p>Let’s simulate heights:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="geocentric-models.html#cb104-1" tabindex="-1"></a><span class="co"># simulate 1e3 data by default</span></span>
<span id="cb104-2"><a href="geocentric-models.html#cb104-2" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq))</span>
<span id="cb104-3"><a href="geocentric-models.html#cb104-3" tabindex="-1"></a><span class="fu">str</span>(sim.height)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:46] 146 139 136 135 138 ...</code></pre>
<p>The resulted matrix contains 1000 simulated heights (rows) for 46 weight values (columns). Let’s summarize it:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="geocentric-models.html#cb106-1" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb106-2"><a href="geocentric-models.html#cb106-2" tabindex="-1"></a>height.PI</span></code></pre></div>
<pre><code>##         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]
## 5%  128.1853 129.4536 130.1615 131.0184 131.5920 132.3106 133.6148
## 94% 144.4269 145.3213 146.0324 147.5608 148.3459 149.0710 150.5475
##         [,8]     [,9]    [,10]    [,11]    [,12]    [,13]    [,14]
## 5%  135.5421 135.8942 136.3520 137.6058 138.6176 139.6518 140.1450
## 94% 151.3630 151.7098 152.9104 153.9036 154.4739 155.3530 156.1087
##        [,15]    [,16]    [,17]    [,18]    [,19]    [,20]    [,21]
## 5%  140.8575 141.6930 143.4392 143.9476 144.7856 145.0695 146.4285
## 94% 157.2042 158.1098 158.6873 159.7029 160.9985 161.8457 162.9799
##        [,22]    [,23]    [,24]    [,25]    [,26]    [,27]    [,28]
## 5%  147.0674 148.4928 149.2981 150.1580 151.7772 151.4979 152.9998
## 94% 163.1741 164.9025 165.5837 165.9044 166.7547 167.7817 168.9641
##        [,29]    [,30]    [,31]    [,32]    [,33]    [,34]    [,35]
## 5%  154.1103 154.4654 155.6601 156.6560 157.6031 158.3161 159.5117
## 94% 169.7019 170.2732 171.7155 171.8713 173.9521 174.8402 175.4895
##        [,36]    [,37]    [,38]    [,39]    [,40]    [,41]    [,42]
## 5%  160.4609 160.9952 161.3552 162.1338 163.4090 164.5611 165.1676
## 94% 176.2916 177.2782 178.1800 179.4627 180.3177 180.4383 181.5567
##        [,43]    [,44]    [,45]    [,46]
## 5%  165.5014 167.6589 168.1717 168.8493
## 94% 182.5953 183.3265 184.1630 185.3150</code></pre>
<p>Now, <code>height.PI</code> contains the 89% (we can use any interval) posterior prediction interval of observable heights across the values of weights in <code>weight.seq</code> (i.e. the boundaries of the simulated heights the model expects)</p>
<p>Let’s plot everything: 1. the average line (MAP line) 2. shaded region of 89% plausible <span class="math inline">\(\mu\)</span> 3. boundaries of the simulated heights the model expects</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="geocentric-models.html#cb108-1" tabindex="-1"></a><span class="co"># plot data points</span></span>
<span id="cb108-2"><a href="geocentric-models.html#cb108-2" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb108-3"><a href="geocentric-models.html#cb108-3" tabindex="-1"></a></span>
<span id="cb108-4"><a href="geocentric-models.html#cb108-4" tabindex="-1"></a><span class="co"># draw MAP line</span></span>
<span id="cb108-5"><a href="geocentric-models.html#cb108-5" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb108-6"><a href="geocentric-models.html#cb108-6" tabindex="-1"></a></span>
<span id="cb108-7"><a href="geocentric-models.html#cb108-7" tabindex="-1"></a><span class="co"># i used the border because the shade is not appearing for a bug related to R version </span></span>
<span id="cb108-8"><a href="geocentric-models.html#cb108-8" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq,<span class="at">border=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-9"><a href="geocentric-models.html#cb108-9" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq, <span class="at">border =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>The narrow boundaries that are close to the line are the intervals of <span class="math inline">\(\mu\)</span>. The wider boundary is the region within which the model expects to find 89% of actual heights in the population at each weight.</p>
<p>The rouglness around the prediction interval is due to the simulation variance. We can decrease that by increasing the number of samples we take from the posterior.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="geocentric-models.html#cb109-1" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq), <span class="at">n=</span><span class="fl">1e4</span>)</span>
<span id="cb109-2"><a href="geocentric-models.html#cb109-2" tabindex="-1"></a></span>
<span id="cb109-3"><a href="geocentric-models.html#cb109-3" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb109-4"><a href="geocentric-models.html#cb109-4" tabindex="-1"></a></span>
<span id="cb109-5"><a href="geocentric-models.html#cb109-5" tabindex="-1"></a></span>
<span id="cb109-6"><a href="geocentric-models.html#cb109-6" tabindex="-1"></a><span class="co"># plot data points</span></span>
<span id="cb109-7"><a href="geocentric-models.html#cb109-7" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb109-8"><a href="geocentric-models.html#cb109-8" tabindex="-1"></a></span>
<span id="cb109-9"><a href="geocentric-models.html#cb109-9" tabindex="-1"></a><span class="co"># draw MAP line</span></span>
<span id="cb109-10"><a href="geocentric-models.html#cb109-10" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb109-11"><a href="geocentric-models.html#cb109-11" tabindex="-1"></a></span>
<span id="cb109-12"><a href="geocentric-models.html#cb109-12" tabindex="-1"></a><span class="co"># i used the border because the shade is not appearing for a bug related to R version </span></span>
<span id="cb109-13"><a href="geocentric-models.html#cb109-13" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq,<span class="at">border=</span><span class="cn">TRUE</span>)</span>
<span id="cb109-14"><a href="geocentric-models.html#cb109-14" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq, <span class="at">border =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
</div>
<div id="curves-from-lines" class="section level2 hasAnchor">
<h2>Curves from lines<a href="geocentric-models.html#curves-from-lines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can build models to describe the outcome as a curved function of a predictor using the linear regression. Here are the common methods: 1. Polynomial regression 2. B-Splines</p>
<div id="polynomial-regression" class="section level3 hasAnchor">
<h3>Polynomial regression<a href="geocentric-models.html#polynomial-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following data is seen to be followed a curved relationship</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="geocentric-models.html#cb110-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb110-2"><a href="geocentric-models.html#cb110-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb110-3"><a href="geocentric-models.html#cb110-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb110-4"><a href="geocentric-models.html#cb110-4" tabindex="-1"></a><span class="fu">plot</span>(height<span class="sc">~</span>weight, d)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>We can use the <strong>parabolic</strong> equation for representing the mean height: <span class="math inline">\(\mu_i = \alpha + \beta_1 x_i + \beta_2 x_i^2\)</span></p>
<p>The last parameter <span class="math inline">\(\beta_2\)</span> measures the curvature of the relationship</p>
<p>Because the polynomial equations involve computing the square or curve of large number, we need to <em>standarize</em> the predictor values in order to avoid the errors in computing estimates. To standarize weight values we do the following:</p>
<p><span class="math display">\[
x_{std.} = \frac{x - \mu_x}{\sigma_x}
\]</span></p>
<p>This unit is called z-score. However, we will use <span class="math inline">\(x\)</span> instead of <span class="math inline">\(x_{std.}\)</span> in the following sections.</p>
<p>This is the definition of our model:</p>
<p><span class="math inline">\(h_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha + \beta_1 x_i + \beta_2 x_i^2\)</span></p>
<p><span class="math inline">\(\alpha \sim Normal(178, 20)\)</span></p>
<p><span class="math inline">\(\beta_1 \sim Log-Normal(0, 1)\)</span></p>
<p><span class="math inline">\(\beta_2 \sim Normal(0, 1)\)</span></p>
<p><span class="math inline">\(\sigma \sim Uniform(0, 50)\)</span></p>
<p>Note that it is okay to have negative values for <span class="math inline">\(\beta_2\)</span>.</p>
<p>Let’s code that and fit the model to our data:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="geocentric-models.html#cb111-1" tabindex="-1"></a>weight_s <span class="ot">&lt;-</span> (d<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight)) <span class="sc">/</span> <span class="fu">sd</span>(d<span class="sc">$</span>weight)</span>
<span id="cb111-2"><a href="geocentric-models.html#cb111-2" tabindex="-1"></a>weight_s2 <span class="ot">&lt;-</span> weight_s <span class="sc">^</span> <span class="dv">2</span></span>
<span id="cb111-3"><a href="geocentric-models.html#cb111-3" tabindex="-1"></a></span>
<span id="cb111-4"><a href="geocentric-models.html#cb111-4" tabindex="-1"></a>m4<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb111-5"><a href="geocentric-models.html#cb111-5" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb111-6"><a href="geocentric-models.html#cb111-6" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb111-7"><a href="geocentric-models.html#cb111-7" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b1<span class="sc">*</span>weight_s <span class="sc">+</span> b2<span class="sc">*</span>weight_s2,</span>
<span id="cb111-8"><a href="geocentric-models.html#cb111-8" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb111-9"><a href="geocentric-models.html#cb111-9" tabindex="-1"></a>    b1 <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb111-10"><a href="geocentric-models.html#cb111-10" tabindex="-1"></a>    b2 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb111-11"><a href="geocentric-models.html#cb111-11" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb111-12"><a href="geocentric-models.html#cb111-12" tabindex="-1"></a>  ), <span class="at">data=</span>d</span>
<span id="cb111-13"><a href="geocentric-models.html#cb111-13" tabindex="-1"></a>)</span>
<span id="cb111-14"><a href="geocentric-models.html#cb111-14" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>##             mean        sd       5.5%      94.5%
## a     146.055966 0.3690246 145.466193 146.645739
## b1     21.733838 0.2889247  21.272081  22.195596
## b2     -7.802658 0.2742178  -8.240911  -7.364405
## sigma   5.775142 0.1765168   5.493034   6.057251</code></pre>
<p>Let’s summarize the prediction and plot it:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="geocentric-models.html#cb113-1" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">2.2</span>, <span class="at">to=</span><span class="dv">2</span>, <span class="at">length.out=</span><span class="dv">30</span>)</span>
<span id="cb113-2"><a href="geocentric-models.html#cb113-2" tabindex="-1"></a>pred_dat <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">weight_s=</span>weight.seq, <span class="at">weight_s2=</span>weight.seq<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb113-3"><a href="geocentric-models.html#cb113-3" tabindex="-1"></a></span>
<span id="cb113-4"><a href="geocentric-models.html#cb113-4" tabindex="-1"></a><span class="co"># compute predictions of mu for pred_dat as input</span></span>
<span id="cb113-5"><a href="geocentric-models.html#cb113-5" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.5</span>, <span class="at">data=</span>pred_dat)</span>
<span id="cb113-6"><a href="geocentric-models.html#cb113-6" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb113-7"><a href="geocentric-models.html#cb113-7" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb113-8"><a href="geocentric-models.html#cb113-8" tabindex="-1"></a></span>
<span id="cb113-9"><a href="geocentric-models.html#cb113-9" tabindex="-1"></a><span class="co"># simulate height values</span></span>
<span id="cb113-10"><a href="geocentric-models.html#cb113-10" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.5</span>, <span class="at">data=</span>pred_dat)</span>
<span id="cb113-11"><a href="geocentric-models.html#cb113-11" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb113-12"><a href="geocentric-models.html#cb113-12" tabindex="-1"></a></span>
<span id="cb113-13"><a href="geocentric-models.html#cb113-13" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight_s, d, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb113-14"><a href="geocentric-models.html#cb113-14" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb113-15"><a href="geocentric-models.html#cb113-15" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq)</span>
<span id="cb113-16"><a href="geocentric-models.html#cb113-16" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>Remember that we are now working on the full data with both adults and non-adults, and that’s why the relationship is not linear as it was with the adults data.</p>
<p>Let’s try building cubic regression on weight:</p>
<p><span class="math inline">\(h_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3\)</span></p>
<p><span class="math inline">\(\alpha \sim Normal(178, 20)\)</span></p>
<p><span class="math inline">\(\beta_1 \sim Log-Normal(0, 1)\)</span></p>
<p><span class="math inline">\(\beta_2 \sim Normal(0, 1)\)</span></p>
<p><span class="math inline">\(\beta_3 \sim Normal(0, 1)\)</span></p>
<p><span class="math inline">\(\sigma \sim Uniform(0,50)\)</span></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="geocentric-models.html#cb114-1" tabindex="-1"></a>weight_s3 <span class="ot">&lt;-</span> weight_s <span class="sc">^</span> <span class="dv">3</span></span>
<span id="cb114-2"><a href="geocentric-models.html#cb114-2" tabindex="-1"></a></span>
<span id="cb114-3"><a href="geocentric-models.html#cb114-3" tabindex="-1"></a>m4<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb114-4"><a href="geocentric-models.html#cb114-4" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb114-5"><a href="geocentric-models.html#cb114-5" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb114-6"><a href="geocentric-models.html#cb114-6" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b1<span class="sc">*</span>weight_s <span class="sc">+</span> b2<span class="sc">*</span>weight_s2 <span class="sc">+</span> b3<span class="sc">*</span>weight_s3,</span>
<span id="cb114-7"><a href="geocentric-models.html#cb114-7" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb114-8"><a href="geocentric-models.html#cb114-8" tabindex="-1"></a>    b1 <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb114-9"><a href="geocentric-models.html#cb114-9" tabindex="-1"></a>    b2 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb114-10"><a href="geocentric-models.html#cb114-10" tabindex="-1"></a>    b3 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb114-11"><a href="geocentric-models.html#cb114-11" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb114-12"><a href="geocentric-models.html#cb114-12" tabindex="-1"></a>  ), <span class="at">data=</span>d</span>
<span id="cb114-13"><a href="geocentric-models.html#cb114-13" tabindex="-1"></a>)</span>
<span id="cb114-14"><a href="geocentric-models.html#cb114-14" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>##             mean        sd       5.5%      94.5%
## a     146.394541 0.3099872 145.899122 146.889960
## b1     15.219737 0.4762654  14.458573  15.980901
## b2     -6.202618 0.2571582  -6.613606  -5.791629
## b3      3.583373 0.2287735   3.217749   3.948997
## sigma   4.829890 0.1469427   4.595047   5.064732</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="geocentric-models.html#cb116-1" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">2.2</span>, <span class="at">to=</span><span class="dv">2</span>, <span class="at">length.out=</span><span class="dv">30</span>)</span>
<span id="cb116-2"><a href="geocentric-models.html#cb116-2" tabindex="-1"></a>pred_dat_m4<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">weight_s=</span>weight.seq, <span class="at">weight_s2=</span>weight.seq<span class="sc">^</span><span class="dv">2</span>, <span class="at">weight_s3=</span>weight.seq<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb116-3"><a href="geocentric-models.html#cb116-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.6</span>, <span class="at">data=</span>pred_dat_m4<span class="fl">.6</span>)</span>
<span id="cb116-4"><a href="geocentric-models.html#cb116-4" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb116-5"><a href="geocentric-models.html#cb116-5" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb116-6"><a href="geocentric-models.html#cb116-6" tabindex="-1"></a></span>
<span id="cb116-7"><a href="geocentric-models.html#cb116-7" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.6</span>, pred_dat_m4<span class="fl">.6</span>)</span>
<span id="cb116-8"><a href="geocentric-models.html#cb116-8" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb116-9"><a href="geocentric-models.html#cb116-9" tabindex="-1"></a></span>
<span id="cb116-10"><a href="geocentric-models.html#cb116-10" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight_s, d, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb116-11"><a href="geocentric-models.html#cb116-11" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb116-12"><a href="geocentric-models.html#cb116-12" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq)</span>
<span id="cb116-13"><a href="geocentric-models.html#cb116-13" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>The cubic model is more flexible than others and that’s why it fits well. However, we stoll have these issues in our model:</p>
<ol style="list-style-type: decimal">
<li>Having a better fit <span class="math inline">\(\neq\)</span> Having a better model</li>
<li>All the models we built so far have no biological information. We haven’t learnt any causal relationship so far</li>
</ol>
<p>The models are good geocentric model = meaning they describe the sample well</p>
<p>Note that the x-axis contains the standardized weight values. To convet back to natural scale, we need to remove the current axis and build the axis explicitly:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="geocentric-models.html#cb117-1" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight_s, d, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>), <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb117-2"><a href="geocentric-models.html#cb117-2" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb117-3"><a href="geocentric-models.html#cb117-3" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq)</span>
<span id="cb117-4"><a href="geocentric-models.html#cb117-4" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq)</span>
<span id="cb117-5"><a href="geocentric-models.html#cb117-5" tabindex="-1"></a></span>
<span id="cb117-6"><a href="geocentric-models.html#cb117-6" tabindex="-1"></a>at <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb117-7"><a href="geocentric-models.html#cb117-7" tabindex="-1"></a><span class="co"># convert z-scores to weight values</span></span>
<span id="cb117-8"><a href="geocentric-models.html#cb117-8" tabindex="-1"></a>labels <span class="ot">&lt;-</span> at<span class="sc">*</span><span class="fu">sd</span>(d<span class="sc">$</span>weight) <span class="sc">+</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight)</span>
<span id="cb117-9"><a href="geocentric-models.html#cb117-9" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span>at, <span class="at">labels=</span><span class="fu">round</span>(labels, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
</div>
<div id="splines" class="section level3 hasAnchor">
<h3>Splines<a href="geocentric-models.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>B-Spline stands for basis spline. It means that we can build wiggly functions from simple less-wiggly bassis components, that are basis functions</p>
<p>We will use data of a 1000 years of blossoms days</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="geocentric-models.html#cb118-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb118-2"><a href="geocentric-models.html#cb118-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cherry_blossoms&quot;</span>)</span>
<span id="cb118-3"><a href="geocentric-models.html#cb118-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> cherry_blossoms</span>
<span id="cb118-4"><a href="geocentric-models.html#cb118-4" tabindex="-1"></a><span class="fu">precis</span>(d, <span class="at">hist=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##                   mean          sd      5.5%      94.5%
## year       1408.000000 350.8845964 867.77000 1948.23000
## doy         104.540508   6.4070362  94.43000  115.00000
## temp          6.141886   0.6636479   5.15000    7.29470
## temp_upper    7.185151   0.9929206   5.89765    8.90235
## temp_lower    5.098941   0.8503496   3.78765    6.37000</code></pre>
<p>The B-Spline model</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="geocentric-models.html#cb120-1" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d),]</span>
<span id="cb120-2"><a href="geocentric-models.html#cb120-2" tabindex="-1"></a>num_knots <span class="ot">=</span> <span class="dv">15</span></span>
<span id="cb120-3"><a href="geocentric-models.html#cb120-3" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(d2<span class="sc">$</span>year, <span class="at">probs=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out=</span>num_knots))</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="geocentric-models.html#cb121-1" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb121-2"><a href="geocentric-models.html#cb121-2" tabindex="-1"></a><span class="co"># create B-spline basis matrix </span></span>
<span id="cb121-3"><a href="geocentric-models.html#cb121-3" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(d2<span class="sc">$</span>year, </span>
<span id="cb121-4"><a href="geocentric-models.html#cb121-4" tabindex="-1"></a>        <span class="at">knots=</span>knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, num_knots)], <span class="co"># -c(1, num_knots) means exclude the 1st and last element</span></span>
<span id="cb121-5"><a href="geocentric-models.html#cb121-5" tabindex="-1"></a>        <span class="at">degree=</span><span class="dv">3</span>,</span>
<span id="cb121-6"><a href="geocentric-models.html#cb121-6" tabindex="-1"></a>        <span class="at">intercept=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="geocentric-models.html#cb122-1" tabindex="-1"></a><span class="co"># Create an empty plot with specified axes</span></span>
<span id="cb122-2"><a href="geocentric-models.html#cb122-2" tabindex="-1"></a>{</span>
<span id="cb122-3"><a href="geocentric-models.html#cb122-3" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>year), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">xlab=</span><span class="st">&quot;year&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;basis&quot;</span>, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb122-4"><a href="geocentric-models.html#cb122-4" tabindex="-1"></a>  </span>
<span id="cb122-5"><a href="geocentric-models.html#cb122-5" tabindex="-1"></a>  <span class="co"># Plot knots</span></span>
<span id="cb122-6"><a href="geocentric-models.html#cb122-6" tabindex="-1"></a>  <span class="cf">for</span> (knot <span class="cf">in</span> knot_list) {</span>
<span id="cb122-7"><a href="geocentric-models.html#cb122-7" tabindex="-1"></a>      <span class="co"># Add a vertical line for each knot</span></span>
<span id="cb122-8"><a href="geocentric-models.html#cb122-8" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="at">v =</span> knot, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb122-9"><a href="geocentric-models.html#cb122-9" tabindex="-1"></a>  }</span>
<span id="cb122-10"><a href="geocentric-models.html#cb122-10" tabindex="-1"></a>  </span>
<span id="cb122-11"><a href="geocentric-models.html#cb122-11" tabindex="-1"></a>  <span class="co"># Plot each column in the basis matrix against year</span></span>
<span id="cb122-12"><a href="geocentric-models.html#cb122-12" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(B)) {</span>
<span id="cb122-13"><a href="geocentric-models.html#cb122-13" tabindex="-1"></a>      <span class="co"># Add lines for each column</span></span>
<span id="cb122-14"><a href="geocentric-models.html#cb122-14" tabindex="-1"></a>      <span class="fu">lines</span>(d2<span class="sc">$</span>year, B[, i])</span>
<span id="cb122-15"><a href="geocentric-models.html#cb122-15" tabindex="-1"></a>  }</span>
<span id="cb122-16"><a href="geocentric-models.html#cb122-16" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p><br />
</p>
<p><br />
</p>
<div id="building-the-model-with-quap" class="section level4 hasAnchor">
<h4>Building the model with <code>quap</code><a href="geocentric-models.html#building-the-model-with-quap" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="geocentric-models.html#cb123-1" tabindex="-1"></a>m4<span class="fl">.7</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb123-2"><a href="geocentric-models.html#cb123-2" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb123-3"><a href="geocentric-models.html#cb123-3" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb123-4"><a href="geocentric-models.html#cb123-4" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w, <span class="co"># matrix multiplication</span></span>
<span id="cb123-5"><a href="geocentric-models.html#cb123-5" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb123-6"><a href="geocentric-models.html#cb123-6" tabindex="-1"></a>    w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb123-7"><a href="geocentric-models.html#cb123-7" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb123-8"><a href="geocentric-models.html#cb123-8" tabindex="-1"></a>  ), </span>
<span id="cb123-9"><a href="geocentric-models.html#cb123-9" tabindex="-1"></a>  <span class="at">data=</span><span class="fu">list</span>(<span class="at">D=</span>d2<span class="sc">$</span>doy, <span class="at">B=</span>B),</span>
<span id="cb123-10"><a href="geocentric-models.html#cb123-10" tabindex="-1"></a>  <span class="at">start=</span><span class="fu">list</span>(<span class="at">w=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(B)))</span>
<span id="cb123-11"><a href="geocentric-models.html#cb123-11" tabindex="-1"></a>)</span></code></pre></div>
<p>Let’s look at the posterior means:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="geocentric-models.html#cb124-1" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>## 17 vector or matrix parameters hidden. Use depth=2 to show them.</code></pre>
<pre><code>##             mean        sd       5.5%      94.5%
## a     104.705268 0.3330644 104.172966 105.237569
## sigma   6.074996 0.1541797   5.828587   6.321405</code></pre>
<p>Let’s plot the posterior predictions:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="geocentric-models.html#cb127-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.7</span>)</span>
<span id="cb127-2"><a href="geocentric-models.html#cb127-2" tabindex="-1"></a><span class="co"># find the mean of all weights</span></span>
<span id="cb127-3"><a href="geocentric-models.html#cb127-3" tabindex="-1"></a></span>
<span id="cb127-4"><a href="geocentric-models.html#cb127-4" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">apply</span>(post<span class="sc">$</span>w, <span class="dv">2</span>, mean)</span>
<span id="cb127-5"><a href="geocentric-models.html#cb127-5" tabindex="-1"></a></span>
<span id="cb127-6"><a href="geocentric-models.html#cb127-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>year), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>),</span>
<span id="cb127-7"><a href="geocentric-models.html#cb127-7" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;year&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;basis * weight&quot;</span>)</span>
<span id="cb127-8"><a href="geocentric-models.html#cb127-8" tabindex="-1"></a></span>
<span id="cb127-9"><a href="geocentric-models.html#cb127-9" tabindex="-1"></a><span class="co"># plot the basis * weight for each column</span></span>
<span id="cb127-10"><a href="geocentric-models.html#cb127-10" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(B)) <span class="fu">lines</span>(d2<span class="sc">$</span>year, w[i]<span class="sc">*</span>B[,i])</span>
<span id="cb127-11"><a href="geocentric-models.html#cb127-11" tabindex="-1"></a></span>
<span id="cb127-12"><a href="geocentric-models.html#cb127-12" tabindex="-1"></a><span class="co"># plot knots</span></span>
<span id="cb127-13"><a href="geocentric-models.html#cb127-13" tabindex="-1"></a><span class="cf">for</span> (knot <span class="cf">in</span> knot_list) {</span>
<span id="cb127-14"><a href="geocentric-models.html#cb127-14" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> knot, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb127-15"><a href="geocentric-models.html#cb127-15" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="geocentric-models.html#cb128-1" tabindex="-1"></a><span class="co"># 97% posterior interval for mu at each year</span></span>
<span id="cb128-2"><a href="geocentric-models.html#cb128-2" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.7</span>)</span>
<span id="cb128-3"><a href="geocentric-models.html#cb128-3" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="fl">0.97</span>)</span>
<span id="cb128-4"><a href="geocentric-models.html#cb128-4" tabindex="-1"></a><span class="fu">plot</span>(d2<span class="sc">$</span>year, d2<span class="sc">$</span>doy, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.3</span>), <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb128-5"><a href="geocentric-models.html#cb128-5" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, d2<span class="sc">$</span>year, <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.5</span>))</span>
<span id="cb128-6"><a href="geocentric-models.html#cb128-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(d2<span class="sc">$</span>doy, <span class="at">col=</span><span class="st">&quot;black&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-91-2.png" width="672" /></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sampling-the-imaginary.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-chapter04.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
