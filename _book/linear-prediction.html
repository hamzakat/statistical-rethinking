<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Linear prediction | Statistical Rethinking - Notes</title>
  <meta name="description" content="Study notes for Statistical Rethinking book" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Linear prediction | Statistical Rethinking - Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Study notes for Statistical Rethinking book" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Linear prediction | Statistical Rethinking - Notes" />
  
  <meta name="twitter:description" content="Study notes for Statistical Rethinking book" />
  

<meta name="author" content="Hamza" />


<meta name="date" content="2024-05-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gaussian-model-of-human-height.html"/>
<link rel="next" href="curves-from-lines.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#render-book"><i class="fa fa-check"></i><b>1.2</b> Render book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preview-book"><i class="fa fa-check"></i><b>1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-p.-33.html"><a href="example-p.-33.html"><i class="fa fa-check"></i><b>2</b> Example (p. 33)</a></li>
<li class="chapter" data-level="3" data-path="grid-approximation.html"><a href="grid-approximation.html"><i class="fa fa-check"></i><b>3</b> Grid Approximation</a></li>
<li class="chapter" data-level="4" data-path="quadratic-approximation.html"><a href="quadratic-approximation.html"><i class="fa fa-check"></i><b>4</b> Quadratic Approximation</a></li>
<li class="chapter" data-level="5" data-path="markov-chain-monte-carlo-mcmc.html"><a href="markov-chain-monte-carlo-mcmc.html"><i class="fa fa-check"></i><b>5</b> Markov Chain Monte Carlo (MCMC)</a></li>
<li class="chapter" data-level="6" data-path="sampling-from-a-grid-approximate-posterior.html"><a href="sampling-from-a-grid-approximate-posterior.html"><i class="fa fa-check"></i><b>6</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="7" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html"><i class="fa fa-check"></i><b>7</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#intervals-of-defined-boundaries"><i class="fa fa-check"></i><b>7.1</b> Intervals of defined boundaries</a></li>
<li class="chapter" data-level="7.2" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>7.2</b> Intervals of defined mass</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#compatibility-interval"><i class="fa fa-check"></i><b>7.2.1</b> Compatibility Interval</a></li>
<li class="chapter" data-level="7.2.2" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#percentile-intervals-pi"><i class="fa fa-check"></i><b>7.2.2</b> Percentile Intervals (PI)</a></li>
<li class="chapter" data-level="7.2.3" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#highest-posterior-density-interval-hpdi"><i class="fa fa-check"></i><b>7.2.3</b> Highest Posterior Density Interval (HPDI)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#point-estimates"><i class="fa fa-check"></i><b>7.3</b> Point Estimates</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#maximum-a-posteriori-estimate-map"><i class="fa fa-check"></i><b>7.3.1</b> Maximum a Posteriori Estimate (MAP)</a></li>
<li class="chapter" data-level="7.3.2" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#loss-function"><i class="fa fa-check"></i><b>7.3.2</b> Loss Function</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="sampling-to-summarize.html"><a href="sampling-to-summarize.html#final-notes-on-summarization"><i class="fa fa-check"></i><b>7.4</b> Final Notes on Summarization</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sampling-to-simulate-prediction.html"><a href="sampling-to-simulate-prediction.html"><i class="fa fa-check"></i><b>8</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sampling-to-simulate-prediction.html"><a href="sampling-to-simulate-prediction.html#dummy-data"><i class="fa fa-check"></i><b>8.1</b> Dummy Data</a></li>
<li class="chapter" data-level="8.2" data-path="sampling-to-simulate-prediction.html"><a href="sampling-to-simulate-prediction.html#model-checking"><i class="fa fa-check"></i><b>8.2</b> Model Checking</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="normal-distribution.html"><a href="normal-distribution.html"><i class="fa fa-check"></i><b>9</b> Normal Distribution</a>
<ul>
<li class="chapter" data-level="9.1" data-path="normal-distribution.html"><a href="normal-distribution.html#normal-by-addition"><i class="fa fa-check"></i><b>9.1</b> Normal by Addition</a></li>
<li class="chapter" data-level="9.2" data-path="normal-distribution.html"><a href="normal-distribution.html#normal-by-multiplication"><i class="fa fa-check"></i><b>9.2</b> Normal by multiplication</a></li>
<li class="chapter" data-level="9.3" data-path="normal-distribution.html"><a href="normal-distribution.html#normal-by-log-multiplication"><i class="fa fa-check"></i><b>9.3</b> Normal by log-multiplication</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html"><i class="fa fa-check"></i><b>10</b> Gaussian model of human height</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#the-data"><i class="fa fa-check"></i><b>10.0.1</b> The data</a></li>
<li class="chapter" data-level="10.0.2" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#the-model-and-prior"><i class="fa fa-check"></i><b>10.0.2</b> The model and prior</a></li>
<li class="chapter" data-level="10.1" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i><b>10.1</b> Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="10.2" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>10.2</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="10.3" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#finding-the-posterior-with-quap"><i class="fa fa-check"></i><b>10.3</b> Finding the posterior with <code>quap</code></a></li>
<li class="chapter" data-level="10.4" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#sampling-from-a-quap"><i class="fa fa-check"></i><b>10.4</b> Sampling from a <code>quap</code></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="gaussian-model-of-human-height.html"><a href="gaussian-model-of-human-height.html#variance-covariance-matrix"><i class="fa fa-check"></i><b>10.4.1</b> Variance-Covariance Matrix</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="linear-prediction.html"><a href="linear-prediction.html"><i class="fa fa-check"></i><b>11</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="11.1" data-path="linear-prediction.html"><a href="linear-prediction.html#linear-model-strategy-probabilistic-approach"><i class="fa fa-check"></i><b>11.1</b> Linear model strategy: probabilistic approach</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="linear-prediction.html"><a href="linear-prediction.html#priors"><i class="fa fa-check"></i><b>11.1.1</b> Priors</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="linear-prediction.html"><a href="linear-prediction.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>11.2</b> Finding the posterior distribution</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="linear-prediction.html"><a href="linear-prediction.html#plotting-the-posterior-against-the-data"><i class="fa fa-check"></i><b>11.2.1</b> Plotting the posterior against the data</a></li>
<li class="chapter" data-level="11.2.2" data-path="linear-prediction.html"><a href="linear-prediction.html#uncertainty-around-the-mean"><i class="fa fa-check"></i><b>11.2.2</b> Uncertainty around the mean</a></li>
<li class="chapter" data-level="11.2.3" data-path="linear-prediction.html"><a href="linear-prediction.html#plotting-regression-intervals-and-contours"><i class="fa fa-check"></i><b>11.2.3</b> Plotting regression intervals and contours</a></li>
<li class="chapter" data-level="11.2.4" data-path="linear-prediction.html"><a href="linear-prediction.html#how-link-works"><i class="fa fa-check"></i><b>11.2.4</b> How <code>link</code> works</a></li>
<li class="chapter" data-level="11.2.5" data-path="linear-prediction.html"><a href="linear-prediction.html#summary-recipe-of-generating-predictions-and-intervals-from-the-posterior"><i class="fa fa-check"></i><b>11.2.5</b> Summary: recipe of generating predictions and intervals from the posterior</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="linear-prediction.html"><a href="linear-prediction.html#prediction-intervals"><i class="fa fa-check"></i><b>11.3</b> Prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="curves-from-lines.html"><a href="curves-from-lines.html"><i class="fa fa-check"></i><b>12</b> Curves from lines</a>
<ul>
<li class="chapter" data-level="12.1" data-path="curves-from-lines.html"><a href="curves-from-lines.html#polynomial-regression"><i class="fa fa-check"></i><b>12.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="12.2" data-path="curves-from-lines.html"><a href="curves-from-lines.html#splines"><i class="fa fa-check"></i><b>12.2</b> Splines</a></li>
<li class="chapter" data-level="12.3" data-path="curves-from-lines.html"><a href="curves-from-lines.html#building-the-model-with-quap"><i class="fa fa-check"></i><b>12.3</b> Building the model with <code>quap</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Rethinking - Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-prediction" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Linear prediction<a href="linear-prediction.html#linear-prediction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Using the association between predictor variables and outcome variable, we want to predict the later. This is how linear regression works.</p>
<div id="linear-model-strategy-probabilistic-approach" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Linear model strategy: probabilistic approach<a href="linear-prediction.html#linear-model-strategy-probabilistic-approach" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>We tell the model (golem) the following: “Assume that the predictor variable has a constant and additive relationship to the mean of the outcome. Consider all the lines (formed by the combinations of parameter values) that relate one variable (or more) to the other. Rank all of these lines by plausibility, given these data.”</p></li>
<li><p>The resulted model is a posterior distribution</p></li>
</ul>
<p>In the following example, we want to predict the height using the weight as a predictor variable. This code plot the data to use in model fitting:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="linear-prediction.html#cb81-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb81-2"><a href="linear-prediction.html#cb81-2" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb81-3"><a href="linear-prediction.html#cb81-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb81-4"><a href="linear-prediction.html#cb81-4" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span>
<span id="cb81-5"><a href="linear-prediction.html#cb81-5" tabindex="-1"></a></span>
<span id="cb81-6"><a href="linear-prediction.html#cb81-6" tabindex="-1"></a><span class="fu">plot</span>(d2<span class="sc">$</span>height <span class="sc">~</span> d2<span class="sc">$</span>weight)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>We want to use the Gaussian model of height we built in the previous chapters but making the mean of height <span class="math inline">\(\mu_i\)</span> is a function of weights where weight values are denoted by <span class="math inline">\(x\)</span>. Here is the model:</p>
<p><span class="math inline">\(h_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p><span class="math inline">\(\mu_i = \alpha + \beta(x_i - \bar{x})\)</span></p>
<p><span class="math inline">\(\alpha \sim Normal(178, 20)\)</span></p>
<p><span class="math inline">\(\beta \sim Normal(0, 10)\)</span></p>
<p><span class="math inline">\(\sigma \sim Uniform(0,50)\)</span></p>
<p>Notations:</p>
<ul>
<li><p><span class="math inline">\(\bar{x}\)</span> is the mean of weights</p></li>
<li><p><span class="math inline">\(x_i\)</span> weight at row <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(\mu_i\)</span> the mean of heights are row <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(h_i\)</span> the height at row <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(\alpha, \beta\)</span> are parameters to learn</p></li>
</ul>
<p>Note all relationships are <strong>Stochastic</strong> except the relationship between the height mean and weight.</p>
<p>The parameters are made up as devices that will help us to manipulate <span class="math inline">\(\mu\)</span>. Here is what each parameter does:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\alpha\)</span> (intercept): represents the expected height when <span class="math inline">\(x_i=\bar{x}\)</span></li>
<li><span class="math inline">\(\beta\)</span> (slope): represents the rate of change in expectation when <span class="math inline">\(x_i\)</span> changes by 1 unit</li>
</ol>
<div id="priors" class="section level3 hasAnchor" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Priors<a href="linear-prediction.html#priors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>The unobserved variables are called <em>parameters</em> (<span class="math inline">\(\alpha, \beta, \sigma\)</span>) and their distributions are called <em>priors.</em></p></li>
<li><p>Each combination of parameter values implies a unique line</p></li>
<li><p>Let’s simulate the prior predictive distribution to see the possible lines</p></li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="linear-prediction.html#cb82-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb82-2"><a href="linear-prediction.html#cb82-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb82-3"><a href="linear-prediction.html#cb82-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb82-4"><a href="linear-prediction.html#cb82-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb82-5"><a href="linear-prediction.html#cb82-5" tabindex="-1"></a></span>
<span id="cb82-6"><a href="linear-prediction.html#cb82-6" tabindex="-1"></a><span class="co"># prepare the canvas for plotting</span></span>
<span id="cb82-7"><a href="linear-prediction.html#cb82-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>), <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb82-8"><a href="linear-prediction.html#cb82-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="co"># no one is shorter than zero!</span></span>
<span id="cb82-9"><a href="linear-prediction.html#cb82-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) <span class="co"># the world&#39;s tallest person</span></span>
<span id="cb82-10"><a href="linear-prediction.html#cb82-10" tabindex="-1"></a></span>
<span id="cb82-11"><a href="linear-prediction.html#cb82-11" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb82-12"><a href="linear-prediction.html#cb82-12" tabindex="-1"></a></span>
<span id="cb82-13"><a href="linear-prediction.html#cb82-13" tabindex="-1"></a><span class="co"># simulate the possible lines</span></span>
<span id="cb82-14"><a href="linear-prediction.html#cb82-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x<span class="sc">-</span>xbar), </span>
<span id="cb82-15"><a href="linear-prediction.html#cb82-15" tabindex="-1"></a>                     <span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb82-16"><a href="linear-prediction.html#cb82-16" tabindex="-1"></a>                     <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb82-17"><a href="linear-prediction.html#cb82-17" tabindex="-1"></a>                     <span class="at">add=</span><span class="cn">TRUE</span>,</span>
<span id="cb82-18"><a href="linear-prediction.html#cb82-18" tabindex="-1"></a>                     <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>As we can see, not all the lines seem to represent the relationship between weight and height for human. Negative relationship doesn’t make sense in this context.</p>
<p>We want to restrict <span class="math inline">\(\beta\)</span> to positive numbers so we only get positive relationship. Therefore, we can define the prior as Log-Normal instead to enforce positive relationship:</p>
<p><span class="math display">\[
\beta \sim Log-Normal(0,1)
\]</span></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="linear-prediction.html#cb83-1" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb83-2"><a href="linear-prediction.html#cb83-2" tabindex="-1"></a><span class="fu">dens</span>(b, <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">5</span>), <span class="at">adj=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>We can see the distribution is defined only on the positive beta values.</p>
<p>Now, let’s do the prior predictive simulation again with the new prior:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="linear-prediction.html#cb84-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb84-2"><a href="linear-prediction.html#cb84-2" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb84-3"><a href="linear-prediction.html#cb84-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb84-4"><a href="linear-prediction.html#cb84-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># log-normal prior</span></span>
<span id="cb84-5"><a href="linear-prediction.html#cb84-5" tabindex="-1"></a></span>
<span id="cb84-6"><a href="linear-prediction.html#cb84-6" tabindex="-1"></a><span class="co"># prepare the canvas for plotting</span></span>
<span id="cb84-7"><a href="linear-prediction.html#cb84-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>), <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb84-8"><a href="linear-prediction.html#cb84-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="co"># no one is shorter than zero!</span></span>
<span id="cb84-9"><a href="linear-prediction.html#cb84-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>) <span class="co"># the world&#39;s tallest person</span></span>
<span id="cb84-10"><a href="linear-prediction.html#cb84-10" tabindex="-1"></a></span>
<span id="cb84-11"><a href="linear-prediction.html#cb84-11" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb84-12"><a href="linear-prediction.html#cb84-12" tabindex="-1"></a></span>
<span id="cb84-13"><a href="linear-prediction.html#cb84-13" tabindex="-1"></a><span class="co"># simulate the possible lines</span></span>
<span id="cb84-14"><a href="linear-prediction.html#cb84-14" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x<span class="sc">-</span>xbar), </span>
<span id="cb84-15"><a href="linear-prediction.html#cb84-15" tabindex="-1"></a>                     <span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb84-16"><a href="linear-prediction.html#cb84-16" tabindex="-1"></a>                     <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight),</span>
<span id="cb84-17"><a href="linear-prediction.html#cb84-17" tabindex="-1"></a>                     <span class="at">add=</span><span class="cn">TRUE</span>,</span>
<span id="cb84-18"><a href="linear-prediction.html#cb84-18" tabindex="-1"></a>                     <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p>Now, the result is much more sensible!</p>
</div>
</div>
<div id="finding-the-posterior-distribution" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Finding the posterior distribution<a href="linear-prediction.html#finding-the-posterior-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The model is defined now along with the priors. We are now ready to build the posterior approximation using <code>quap</code></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="linear-prediction.html#cb85-1" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb85-2"><a href="linear-prediction.html#cb85-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb85-3"><a href="linear-prediction.html#cb85-3" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb85-4"><a href="linear-prediction.html#cb85-4" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span>
<span id="cb85-5"><a href="linear-prediction.html#cb85-5" tabindex="-1"></a></span>
<span id="cb85-6"><a href="linear-prediction.html#cb85-6" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb85-7"><a href="linear-prediction.html#cb85-7" tabindex="-1"></a></span>
<span id="cb85-8"><a href="linear-prediction.html#cb85-8" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb85-9"><a href="linear-prediction.html#cb85-9" tabindex="-1"></a></span>
<span id="cb85-10"><a href="linear-prediction.html#cb85-10" tabindex="-1"></a>m4<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb85-11"><a href="linear-prediction.html#cb85-11" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb85-12"><a href="linear-prediction.html#cb85-12" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb85-13"><a href="linear-prediction.html#cb85-13" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight<span class="sc">-</span>xbar),</span>
<span id="cb85-14"><a href="linear-prediction.html#cb85-14" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb85-15"><a href="linear-prediction.html#cb85-15" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb85-16"><a href="linear-prediction.html#cb85-16" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb85-17"><a href="linear-prediction.html#cb85-17" tabindex="-1"></a>  ),</span>
<span id="cb85-18"><a href="linear-prediction.html#cb85-18" tabindex="-1"></a>  <span class="at">data=</span>d2</span>
<span id="cb85-19"><a href="linear-prediction.html#cb85-19" tabindex="-1"></a>)</span></code></pre></div>
<p>To interpret the posterior, we can use either tables or plots. Plots gives more information about the posterior. However, let’s see the summary table:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="linear-prediction.html#cb86-1" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##              mean         sd        5.5%       94.5%
## a     154.6013671 0.27030766 154.1693633 155.0333710
## b       0.9032807 0.04192363   0.8362787   0.9702828
## sigma   5.0718809 0.19115478   4.7663786   5.3773831</code></pre>
<p>We also need to see the covariance among the parameters by computing the variance-covariance matrix:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="linear-prediction.html#cb88-1" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">vcov</span>(m4<span class="fl">.3</span>), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           a     b sigma
## a     0.073 0.000 0.000
## b     0.000 0.002 0.000
## sigma 0.000 0.000 0.037</code></pre>
<div id="plotting-the-posterior-against-the-data" class="section level3 hasAnchor" number="11.2.1">
<h3><span class="header-section-number">11.2.1</span> Plotting the posterior against the data<a href="linear-prediction.html#plotting-the-posterior-against-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="linear-prediction.html#cb90-1" tabindex="-1"></a><span class="fu">plot</span>(height<span class="sc">~</span>weight, <span class="at">data=</span>d2, <span class="at">col=</span>rangi2)</span>
<span id="cb90-2"><a href="linear-prediction.html#cb90-2" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb90-3"><a href="linear-prediction.html#cb90-3" tabindex="-1"></a>a_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>a)</span>
<span id="cb90-4"><a href="linear-prediction.html#cb90-4" tabindex="-1"></a>b_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>b)</span>
<span id="cb90-5"><a href="linear-prediction.html#cb90-5" tabindex="-1"></a><span class="fu">curve</span>(a_map <span class="sc">+</span> b_map <span class="sc">*</span> (x<span class="sc">-</span>xbar), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="linear-prediction.html#cb91-1" tabindex="-1"></a>post[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##          a         b    sigma
## 1 154.5564 0.9000245 4.768499
## 2 154.4602 0.8474034 5.136055
## 3 154.7858 0.9440438 5.313512
## 4 154.4490 0.8806246 4.683555
## 5 154.4639 0.8397176 5.185017</code></pre>
</div>
<div id="uncertainty-around-the-mean" class="section level3 hasAnchor" number="11.2.2">
<h3><span class="header-section-number">11.2.2</span> Uncertainty around the mean<a href="linear-prediction.html#uncertainty-around-the-mean" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We want to know the uncertainty around the mean of posterior in order to determine the confidence in the relationship between predictor and outcome, since the posterior we plot in the previous step is the MAP, which is the mean of many lines formed by the posterior.</p>
<p>Here is a sample of possible lines:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="linear-prediction.html#cb93-1" tabindex="-1"></a>post[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre><code>##          a         b    sigma
## 1 154.5564 0.9000245 4.768499
## 2 154.4602 0.8474034 5.136055
## 3 154.7858 0.9440438 5.313512
## 4 154.4490 0.8806246 4.683555
## 5 154.4639 0.8397176 5.185017</code></pre>
<p>Let’s see how the confident about the location of the mean changes based on data size. First, we will extract the first 10 cases and re-estimate the model:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="linear-prediction.html#cb95-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb95-2"><a href="linear-prediction.html#cb95-2" tabindex="-1"></a>dN <span class="ot">&lt;-</span> d2[<span class="dv">1</span><span class="sc">:</span>N, ]</span>
<span id="cb95-3"><a href="linear-prediction.html#cb95-3" tabindex="-1"></a>mN <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb95-4"><a href="linear-prediction.html#cb95-4" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb95-5"><a href="linear-prediction.html#cb95-5" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb95-6"><a href="linear-prediction.html#cb95-6" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a<span class="sc">+</span>b<span class="sc">*</span>(weight <span class="sc">-</span> <span class="fu">mean</span>(weight)),</span>
<span id="cb95-7"><a href="linear-prediction.html#cb95-7" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb95-8"><a href="linear-prediction.html#cb95-8" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb95-9"><a href="linear-prediction.html#cb95-9" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb95-10"><a href="linear-prediction.html#cb95-10" tabindex="-1"></a>  ), <span class="at">data=</span>dN</span>
<span id="cb95-11"><a href="linear-prediction.html#cb95-11" tabindex="-1"></a>)</span></code></pre></div>
<p>Plot 20 of these lines to see what the uncertainty looks like:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="linear-prediction.html#cb96-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(mN, <span class="at">n=</span><span class="dv">20</span>)</span>
<span id="cb96-2"><a href="linear-prediction.html#cb96-2" tabindex="-1"></a></span>
<span id="cb96-3"><a href="linear-prediction.html#cb96-3" tabindex="-1"></a><span class="co"># plot the 10 sampled cases</span></span>
<span id="cb96-4"><a href="linear-prediction.html#cb96-4" tabindex="-1"></a><span class="fu">plot</span>(dN<span class="sc">$</span>weight, dN<span class="sc">$</span>height, </span>
<span id="cb96-5"><a href="linear-prediction.html#cb96-5" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">range</span>(d2<span class="sc">$</span>height),</span>
<span id="cb96-6"><a href="linear-prediction.html#cb96-6" tabindex="-1"></a>     <span class="at">col=</span>rangi2, <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb96-7"><a href="linear-prediction.html#cb96-7" tabindex="-1"></a></span>
<span id="cb96-8"><a href="linear-prediction.html#cb96-8" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">concat</span>(<span class="st">&quot;N = &quot;</span>, N))</span>
<span id="cb96-9"><a href="linear-prediction.html#cb96-9" tabindex="-1"></a></span>
<span id="cb96-10"><a href="linear-prediction.html#cb96-10" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) <span class="fu">curve</span>(post<span class="sc">$</span>a[i] <span class="sc">+</span> post<span class="sc">$</span>b[i] <span class="sc">*</span> (x<span class="sc">-</span><span class="fu">mean</span>(dN<span class="sc">$</span>weight)),                <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>, <span class="fl">0.3</span>), <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="plotting-regression-intervals-and-contours" class="section level3 hasAnchor" number="11.2.3">
<h3><span class="header-section-number">11.2.3</span> Plotting regression intervals and contours<a href="linear-prediction.html#plotting-regression-intervals-and-contours" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s find the quadratic posterior distribution of the mean height <span class="math inline">\(\mu\)</span> when weight is 50 kg. This distribution represents the relative plausibility of different values of the mean:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="linear-prediction.html#cb97-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb97-2"><a href="linear-prediction.html#cb97-2" tabindex="-1"></a>mu_at_50 <span class="ot">&lt;-</span> post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b <span class="sc">*</span> (<span class="dv">50</span><span class="sc">-</span>xbar)</span>
<span id="cb97-3"><a href="linear-prediction.html#cb97-3" tabindex="-1"></a><span class="fu">dens</span>(mu_at_50, <span class="at">col=</span>rangi2, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlab=</span><span class="st">&quot;mu|weight=50&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Compatibility interval of <span class="math inline">\(\mu\)</span> at 50 kg is:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="linear-prediction.html#cb98-1" tabindex="-1"></a><span class="fu">PI</span>(mu_at_50, <span class="at">prob =</span> <span class="fl">0.89</span>)</span></code></pre></div>
<pre><code>##       5%      94% 
## 158.5839 159.6832</code></pre>
<p>To do that for all weight values:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="linear-prediction.html#cb100-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.3</span>)</span>
<span id="cb100-2"><a href="linear-prediction.html#cb100-2" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:352] 157 157 157 158 157 ...</code></pre>
<p>The resulted matrix contains 352 columns, each corresponds to one row in the <code>d2</code> data. It contains 1000 rows, each represents a sample. Therefore, the matrix contains a distribution of <span class="math inline">\(\mu\)</span> for each individual in the original data <code>d2</code>.</p>
<p>Let’s plot the Gaussian distribution for each mean value:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="linear-prediction.html#cb102-1" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb102-2"><a href="linear-prediction.html#cb102-2" tabindex="-1"></a></span>
<span id="cb102-3"><a href="linear-prediction.html#cb102-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)  <span class="fu">points</span>(d2<span class="sc">$</span>weight, mu[i,], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<p>The pile of points represents the rows.</p>
<p>The plot is kind of missy, let’s do that for a small group of weight values</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="linear-prediction.html#cb103-1" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">25</span>, <span class="at">to=</span><span class="dv">70</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb103-2"><a href="linear-prediction.html#cb103-2" tabindex="-1"></a></span>
<span id="cb103-3"><a href="linear-prediction.html#cb103-3" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">weight=</span>weight.seq))</span>
<span id="cb103-4"><a href="linear-prediction.html#cb103-4" tabindex="-1"></a></span>
<span id="cb103-5"><a href="linear-prediction.html#cb103-5" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb103-6"><a href="linear-prediction.html#cb103-6" tabindex="-1"></a></span>
<span id="cb103-7"><a href="linear-prediction.html#cb103-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)  <span class="fu">points</span>(weight.seq, mu[i,], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Now, let’s summarize the distribution of mu</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="linear-prediction.html#cb104-1" tabindex="-1"></a><span class="co"># compute the mean of each column (dimension 2) of the matrix mu</span></span>
<span id="cb104-2"><a href="linear-prediction.html#cb104-2" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb104-3"><a href="linear-prediction.html#cb104-3" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb104-4"><a href="linear-prediction.html#cb104-4" tabindex="-1"></a></span>
<span id="cb104-5"><a href="linear-prediction.html#cb104-5" tabindex="-1"></a><span class="co"># plot the line and the interval</span></span>
<span id="cb104-6"><a href="linear-prediction.html#cb104-6" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, <span class="at">data=</span>d2, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb104-7"><a href="linear-prediction.html#cb104-7" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb104-8"><a href="linear-prediction.html#cb104-8" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="how-link-works" class="section level3 hasAnchor" number="11.2.4">
<h3><span class="header-section-number">11.2.4</span> How <code>link</code> works<a href="linear-prediction.html#how-link-works" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This approach can be used to generate posterior predictions for any component of any model</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="linear-prediction.html#cb105-1" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb105-2"><a href="linear-prediction.html#cb105-2" tabindex="-1"></a>mu.link <span class="ot">&lt;-</span> <span class="cf">function</span>(weight) post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b<span class="sc">*</span>(weight<span class="sc">-</span>xbar)</span>
<span id="cb105-3"><a href="linear-prediction.html#cb105-3" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">70</span>,<span class="dv">1</span>)</span>
<span id="cb105-4"><a href="linear-prediction.html#cb105-4" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">sapply</span>(weight.seq, mu.link)</span>
<span id="cb105-5"><a href="linear-prediction.html#cb105-5" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb105-6"><a href="linear-prediction.html#cb105-6" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span></code></pre></div>
</div>
<div id="summary-recipe-of-generating-predictions-and-intervals-from-the-posterior" class="section level3 hasAnchor" number="11.2.5">
<h3><span class="header-section-number">11.2.5</span> Summary: recipe of generating predictions and intervals from the posterior<a href="linear-prediction.html#summary-recipe-of-generating-predictions-and-intervals-from-the-posterior" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Use <code>link</code> to generate distributions posterior values for <span class="math inline">\(\mu\)</span></li>
<li>Use <code>mean</code> or <code>PI</code> to find averages and bounds of <span class="math inline">\(\mu\)</span> for each value of the predictor variable</li>
<li>Plot the lines and intervals using <code>lines</code> and <code>shades</code> or the distribution of the prediction given the value of predictor(s)</li>
</ol>
</div>
</div>
<div id="prediction-intervals" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Prediction intervals<a href="linear-prediction.html#prediction-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What we’ve done so far is just use samples from the posterior to visualize the uncertainty in <span class="math inline">\(\mu_i\)</span>. Now, we want to compute the predictions of heights that’s distributed according to: <span class="math inline">\(h_i \sim Normal(\mu_i, \sigma)\)</span></p>
<p>Let’s simulate heights:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="linear-prediction.html#cb106-1" tabindex="-1"></a><span class="co"># simulate 1e3 data by default</span></span>
<span id="cb106-2"><a href="linear-prediction.html#cb106-2" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq))</span>
<span id="cb106-3"><a href="linear-prediction.html#cb106-3" tabindex="-1"></a><span class="fu">str</span>(sim.height)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:46] 146 139 136 135 138 ...</code></pre>
<p>The resulted matrix contains 1000 simulated heights (rows) for 46 weight values (columns). Let’s summarize it:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="linear-prediction.html#cb108-1" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb108-2"><a href="linear-prediction.html#cb108-2" tabindex="-1"></a>height.PI</span></code></pre></div>
<pre><code>##         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]
## 5%  128.1853 129.4536 130.1615 131.0184 131.5920 132.3106 133.6148
## 94% 144.4269 145.3213 146.0324 147.5608 148.3459 149.0710 150.5475
##         [,8]     [,9]    [,10]    [,11]    [,12]    [,13]    [,14]
## 5%  135.5421 135.8942 136.3520 137.6058 138.6176 139.6518 140.1450
## 94% 151.3630 151.7098 152.9104 153.9036 154.4739 155.3530 156.1087
##        [,15]    [,16]    [,17]    [,18]    [,19]    [,20]    [,21]
## 5%  140.8575 141.6930 143.4392 143.9476 144.7856 145.0695 146.4285
## 94% 157.2042 158.1098 158.6873 159.7029 160.9985 161.8457 162.9799
##        [,22]    [,23]    [,24]    [,25]    [,26]    [,27]    [,28]
## 5%  147.0674 148.4928 149.2981 150.1580 151.7772 151.4979 152.9998
## 94% 163.1741 164.9025 165.5837 165.9044 166.7547 167.7817 168.9641
##        [,29]    [,30]    [,31]    [,32]    [,33]    [,34]    [,35]
## 5%  154.1103 154.4654 155.6601 156.6560 157.6031 158.3161 159.5117
## 94% 169.7019 170.2732 171.7155 171.8713 173.9521 174.8402 175.4895
##        [,36]    [,37]    [,38]    [,39]    [,40]    [,41]    [,42]
## 5%  160.4609 160.9952 161.3552 162.1338 163.4090 164.5611 165.1676
## 94% 176.2916 177.2782 178.1800 179.4627 180.3177 180.4383 181.5567
##        [,43]    [,44]    [,45]    [,46]
## 5%  165.5014 167.6589 168.1717 168.8493
## 94% 182.5953 183.3265 184.1630 185.3150</code></pre>
<p>Now, <code>height.PI</code> contains the 89% (we can use any interval) posterior prediction interval of observable heights across the values of weights in <code>weight.seq</code> (i.e. the boundaries of the simulated heights the model expects)</p>
<p>Let’s plot everything: 1. the average line (MAP line) 2. shaded region of 89% plausible <span class="math inline">\(\mu\)</span> 3. boundaries of the simulated heights the model expects</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="linear-prediction.html#cb110-1" tabindex="-1"></a><span class="co"># plot data points</span></span>
<span id="cb110-2"><a href="linear-prediction.html#cb110-2" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb110-3"><a href="linear-prediction.html#cb110-3" tabindex="-1"></a></span>
<span id="cb110-4"><a href="linear-prediction.html#cb110-4" tabindex="-1"></a><span class="co"># draw MAP line</span></span>
<span id="cb110-5"><a href="linear-prediction.html#cb110-5" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb110-6"><a href="linear-prediction.html#cb110-6" tabindex="-1"></a></span>
<span id="cb110-7"><a href="linear-prediction.html#cb110-7" tabindex="-1"></a><span class="co"># i used the border because the shade is not appearing for a bug related to R version </span></span>
<span id="cb110-8"><a href="linear-prediction.html#cb110-8" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq,<span class="at">border=</span><span class="cn">TRUE</span>)</span>
<span id="cb110-9"><a href="linear-prediction.html#cb110-9" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq, <span class="at">border =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>The narrow boundaries that are close to the line are the intervals of <span class="math inline">\(\mu\)</span>. The wider boundary is the region within which the model expects to find 89% of actual heights in the population at each weight.</p>
<p>The rouglness around the prediction interval is due to the simulation variance. We can decrease that by increasing the number of samples we take from the posterior.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="linear-prediction.html#cb111-1" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq), <span class="at">n=</span><span class="fl">1e4</span>)</span>
<span id="cb111-2"><a href="linear-prediction.html#cb111-2" tabindex="-1"></a></span>
<span id="cb111-3"><a href="linear-prediction.html#cb111-3" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>)</span>
<span id="cb111-4"><a href="linear-prediction.html#cb111-4" tabindex="-1"></a></span>
<span id="cb111-5"><a href="linear-prediction.html#cb111-5" tabindex="-1"></a></span>
<span id="cb111-6"><a href="linear-prediction.html#cb111-6" tabindex="-1"></a><span class="co"># plot data points</span></span>
<span id="cb111-7"><a href="linear-prediction.html#cb111-7" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb111-8"><a href="linear-prediction.html#cb111-8" tabindex="-1"></a></span>
<span id="cb111-9"><a href="linear-prediction.html#cb111-9" tabindex="-1"></a><span class="co"># draw MAP line</span></span>
<span id="cb111-10"><a href="linear-prediction.html#cb111-10" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb111-11"><a href="linear-prediction.html#cb111-11" tabindex="-1"></a></span>
<span id="cb111-12"><a href="linear-prediction.html#cb111-12" tabindex="-1"></a><span class="co"># i used the border because the shade is not appearing for a bug related to R version </span></span>
<span id="cb111-13"><a href="linear-prediction.html#cb111-13" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq,<span class="at">border=</span><span class="cn">TRUE</span>)</span>
<span id="cb111-14"><a href="linear-prediction.html#cb111-14" tabindex="-1"></a><span class="fu">shade</span>(height.PI, weight.seq, <span class="at">border =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gaussian-model-of-human-height.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="curves-from-lines.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-chapter04.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
